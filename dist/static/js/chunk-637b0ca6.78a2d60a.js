(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-637b0ca6"],{"2cca":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-nav-bar",{attrs:{title:"完善合同内容","left-text":"返回","right-text":"保存","left-arrow":"","safe-area-inset-top":!0},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight}}),n("div",{staticClass:"vanDrop",staticStyle:{height:"51px",border:"1px solid white"}},[n("van-dropdown-menu",{staticClass:"vanDr",attrs:{"active-color":"#1989fa",overlay:!0,"custom-style":{background:"rgba(255,255,255,0)"}}},[n("van-dropdown-item",{attrs:{options:this.arrList1,change:t.onchange},nativeOn:{click:function(e){return t.onchange(t.value1)}},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}})],1)],1),n("div",{staticStyle:{"margin-top":"10px",height:"550px",border:"1px solid white","border-bottom":"1px solid #eaeaea"}},[n("div",{staticClass:"pdfContent_1PW2f"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isShow,expression:"!isShow"}],ref:"pdfBox",staticClass:"pdf-container",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.1)"}},[n("div",{staticClass:"pdf-box",style:{width:t.pdfWidth/2+"px"}},t._l(t.page_count,(function(e){return n("div",{key:e,staticClass:"pdfPage_1yRne"},[n("canvas",{style:{width:t.pdfWidth/2+"px",height:t.pdfHeight/2+"px"},attrs:{id:"the-canvas"+e}}),n("div",{staticClass:"dragLayer_3ccsq",attrs:{id:"can"+e}})])})),0)])]),1==this.m?n("div",[n("van-row",[n("van-col",{attrs:{span:"12"}},[n("div",{staticStyle:{"font-size":"12px","text-align":"center","margin-top":"40px"}},[t._v(" 合同中还有"+t._s(this.paramsform.length)+"处必需要完善")])]),n("van-col",{attrs:{span:"9"}},[n("van-button",{staticClass:"btnSty",attrs:{round:"",block:"","native-type":"submit"},on:{click:t.showPopup}},[t._v(" 完善合同 ")])],1)],1)],1):t._e(),n("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.isshow,callback:function(e){t.isshow=e},expression:"isshow"}},[n("el-form",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],ref:"queryForm",attrs:{model:t.attachParams,inline:!0}},t._l(t.paramsform,(function(e,a){return n(e.type,{key:e.name,ref:"child",refInFor:!0,tag:"component",attrs:{item:e,number:a},on:{change:t.changeValue}})})),1),n("van-button",{staticClass:"btnSty",attrs:{round:"",block:""},on:{click:t.saveParams}},[t._v(" 填好了 ")])],1)],1)],1)},i=[],o=(n("d3b7"),n("159b"),n("b0c0"),n("4ec9"),n("3ca3"),n("ddb0"),n("2b0e")),c=n("b970"),r=(n("157a"),n("30c2")),s=n("9410");o["default"].use(c["a"]);var l={components:{String:s["b"],Number:s["a"]},data:function(){return{baseurl:"/prod-api",activeNameLeft:"1",isShow:!1,id:"",hasChoose2:!1,hasChoose:!1,scrollTop:0,activeName:"2",pageNum:1,scale:1,page_num:0,page_count:0,maxscale:2,minscale:.5,pdfWidth:0,pdfHeight:0,contract_info:{},contract_attach:[],attach_id:"",contract_img:[],attach_idArr:"",contract_id:"",paramsform:[],attachParams:{},param:{},arrList:[],arrList1:[],heights:void 0,widths:void 0,value1:0,arr:[],m:1,isshow:!1}},created:function(){this.contract_id=this.$route.params.id,this.mobile=localStorage.getItem("siteMobile"),this.getAttachParam(),this.getHeights()},mounted:function(){this.$nextTick((function(){this.$refs.pdfBox.addEventListener("scroll",this.handleScroll,!1)}))},methods:{saveParams:function(){var t=this,e={contractId:this.contract_id,params:this.attachParams};this.$dialog.confirm({message:"确定您已经把所有合同中需要完善的内容都已填写完毕，并确认无误吗？",confirmButtonColor:"red"}).then((function(){Object(r["a"])(e).then((function(e){console.log(e),200===e.code&&Object(r["e"])(t.contract_id).then((function(e){if(200===e.code){var n=e.buttonType;"1"==n?t.$router.push("/sign/editparams/"+t.contract_id):t.$router.push("/sign/send/"+t.contract_id)}}))})),console.log("点击了确认")})).catch((function(){console.log("点击了取消")}))},onchange:function(t){this.jump(1,t)},jump:function(t,e){var n=0;this.contract_attach.forEach((function(a,i){i!=e?n+=a.contractImgList.length:t=n+t}));var a=this,i=this.page_num-1;t&&(i=t-1);var o=document.querySelectorAll(".pdfPage_1yRne"),c=o[i].offsetTop,r=this.scrollTop,s=c/30>>0;if(c>r)u();else{var l=r-c;s=l/30>>0,h()}function u(){r<c?(r+=s,a.$refs.pdfBox.scrollTop=r,setTimeout(u,10)):a.$refs.pdfBox.scrollTop=c}function h(){r>c?(r-=s,a.$refs.pdfBox.scrollTop=r,setTimeout(h,10)):a.$refs.pdfBox.scrollTop=c}},showPopup:function(){this.isshow=!0},qianshu:function(){var t=this,e=this.contract_id;this.$dialog.confirm({message:"确定您已经把所有合同中需要完善的内容都已填写完毕，并确认无误吗？",confirmButtonColor:"red"}).then((function(){t.$router.push("/sign/send/"+e),console.log("点击了确认")})).catch((function(){console.log("点击了取消")}))},changeValue:function(t,e){this.$set(this.attachParams,t.name,t.value)},onClickLeft:function(){this.$router.go(-1)},onClickRight:function(){this.$dialog.alert({message:"弹窗内容"})},getPic:function(){var t=this;Object(r["d"])(this.contract_id).then((function(e){if(200===e.code){t.contract_attach=e.data,t.attach_id=t.contract_attach[0].id,t.page_count=0;for(var n=0;n<t.contract_attach.length;n++)t.page_count=t.page_count+t.contract_attach[n].contractImgList.length,t.arrList.push(t.contract_attach[n].contractDocName);var a=[];t.arrList.forEach((function(t,e){a.push({text:t,value:e})})),t.arrList1=a,t.loadFile()}}))},getAttachParam:function(){var t=this;Object(r["c"])({contractId:this.contract_id}).then((function(e){200===e.code&&(t.paramsform=e.data,t.getPic())}))},onSubmit:function(){},handleScroll:function(t){var e=this;this.scrollTop=this.$refs.pdfBox.scrollTop;var n=document.querySelectorAll(".pdfPage_1yRne"),a=[];n.forEach((function(t,n){e.scrollTop>=t.offsetTop&&a.push(n)})),this.page_num=Math.max.apply(null,a)+1},loadFile:function(){var t=this;this.$nextTick((function(){t.pageNum=1,t.page_num=1,t.attach_idArr=new Map;for(var e=0;e<t.contract_attach.length;e++){var n=t.contract_attach[e].contractImgList;t.isShow=!0;for(var a=1;a<=n.length;a++){var i=n[a-1].contractImgUrl,o=n[a-1].seq;t.attach_idArr.set(t.pageNum,t.contract_attach[e].id+"||"+o),t.renderPage(t.pageNum,i),t.pageNum++}}}))},getHeights:function(){var t=document.documentElement.scrollWidth||document.body.scrollWidth,e=document.documentElement.clientHeight;this.widths=t,this.heights=e},renderPage:function(t,e){var n=document.getElementById("the-canvas"+t),a=n.getContext("2d"),i=new Image;i.onload=function(){a.drawImage(i,0,0,n.width,n.height)},i.src=this.baseurl+e,this.pdfHeight=n.height=1.4*this.heights,this.pdfWidth=n.width=1.8*this.widths},goback:function(){this.$router.push("/sign/signviews/"+this.contract_id)}}},u=l,h=(n("a247"),n("0c7c")),d=Object(h["a"])(u,a,i,!1,null,null,null);e["default"]=d.exports},"30c2":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"g",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return r})),n.d(e,"h",(function(){return s})),n.d(e,"f",(function(){return l})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return h}));var a=n("b775");function i(t){return Object(a["a"])({url:"/contract/attach/getinfo/"+t,method:"get"})}function o(t){return Object(a["a"])({url:"/contract/sign",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/contract/attach/param",method:"get",params:t})}function r(t){return Object(a["a"])({url:"/contract/attach",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/contract/attach",method:"put",data:t})}function l(t){return Object(a["a"])({url:"/sign/seal/getSealList",method:"get",params:t})}function u(t){return Object(a["a"])({url:"/contract/attach/getPic/"+t,method:"get"})}function h(t){return Object(a["a"])({url:"/contract/attach/perfect/"+t,method:"get"})}},"4db9":function(t,e,n){},"4ec9":function(t,e,n){"use strict";var a=n("6d61"),i=n("6566");t.exports=a("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),i)},9410:function(t,e,n){"use strict";n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return p}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.item?n("div",[n("el-form-item",{attrs:{label:t.item.title,prop:t.item.name}},[n("el-input",{attrs:{placeholder:t.item.prompt_msg,size:"mini"},on:{input:t.handleInput},model:{value:t.perInfo[t.item.val],callback:function(e){t.$set(t.perInfo,t.item.val,e)},expression:"perInfo[item.val]"}})],1)],1):t._e()},i=[],o=(n("b0c0"),{name:"String",props:["item"],data:function(){return{perInfo:{input:this.item.value}}},created:function(){this.handleInput(this.item.value)},methods:{handleInput:function(t){this.$emit("change",{name:this.item.name,value:t})},resetData:function(){console.log("我是子组件的方法1"),this.$ref.resetFields()}}}),c=o,r=n("0c7c"),s=Object(r["a"])(c,a,i,!1,null,null,null),l=s.exports,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.item?n("div",[n("el-form-item",{attrs:{label:t.item.title,prop:t.item.name}},[n("el-input-number",{attrs:{min:1,max:1110,size:"mini",precision:2,"controls-position":"right"},on:{change:t.handleChange},model:{value:t.perInfo[t.item.val],callback:function(e){t.$set(t.perInfo,t.item.val,e)},expression:"perInfo[item.val]"}})],1)],1):t._e()},h=[],d={props:["item"],data:function(){return{perInfo:{}}},created:function(){this.$set(this.perInfo,this.item.val,this.item.value)},methods:{handleChange:function(t){this.$emit("change",{name:this.item.name,value:t})},resetData:function(){console.log("我是子组件的方法"),this.resetForm("queryForm")}}},m=d,f=Object(r["a"])(m,u,h,!1,null,null,null),p=f.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.item?n("div",[n("el-form-item",{attrs:{label:t.item.title,prop:t.item.name}},[n("el-select",{attrs:{placeholder:t.item.prompt_msg,size:"mini"},on:{change:t.handleChange},model:{value:t.perInfo[t.item.val],callback:function(e){t.$set(t.perInfo,t.item.val,e)},expression:"perInfo[item.val]"}},t._l(t.statusOptions,(function(t){return n("el-option",{key:t.dictValue,attrs:{label:t.dictLabel,value:t.dictValue}})})),1)],1)],1):t._e()},v=[],b={name:"Select_item",props:["item"],data:function(){return{perInfo:{},statusOptions:[]}},created:function(){var t=this;this.$set(this.perInfo,this.item.val,this.item.value),this.getDicts(this.item.selectOptionsType).then((function(e){t.statusOptions=e.data}))},methods:{handleChange:function(t){this.$emit("change",{name:this.item.name,value:t})},resetData:function(){console.log("我是子组件的方法"),this.resetForm(perInfo)}}},_=b,x=Object(r["a"])(_,g,v,!1,null,null,null);x.exports},a247:function(t,e,n){"use strict";n("4db9")}}]);