(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-025ed5e0"],{"05b8":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pageContent_2lAGg1",attrs:{id:"pageContent"}},[n("div",{staticClass:"leftALL"},[n("div",{staticClass:"leftTop"},[n("el-row",[n("el-col",{attrs:{span:4}},[n("div",{staticClass:"fileList"})]),n("el-col",{attrs:{span:18}},[n("div",{staticClass:"fileList"},[t._v("文件列表"),n("span",[t._v("("+t._s(this.contract_attach.length)+"份)")])])]),n("el-col",{attrs:{span:2}},[n("div",{staticClass:"fileList"},[n("el-popover",{attrs:{placement:"right-start",width:"280",trigger:"hover"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("div",{staticStyle:{"text-align":"left",margin:"0"}},[n("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.downcontact(t.contract_info)}}},[t._v("下载")]),n("div",{staticStyle:{"font-size":"11px",color:"#333","margin-bottom":"5px"}},[t._v(t._s(this.contract_info.name))]),n("el-row",[n("div",{staticStyle:{"font-size":"11px",color:"#333"}},[t._v("于"+t._s(t.parseTime(this.contract_info.updateTime,"{y}年{m}月{d}日{h}:{m}:{s}")+t.statusdict[this.contract_info.status]))])])],1),n("svg-icon",{staticStyle:{"font-size":"22px","margin-left":"10px"},attrs:{slot:"reference","class-name":"search-icon","icon-class":"shudian"},slot:"reference"})],1)],1)])],1),n("div",{staticClass:"carouselList"},[n("el-carousel",{attrs:{height:"250px",type:"card",autoplay:!1},on:{change:t.handelChange}},t._l(t.contract_attach,(function(e,a){return n("el-carousel-item",{key:a},[n("div",{staticClass:"doc-name"},[t._v(t._s(e.contractDocName))]),n("el-image",{attrs:{src:t.baseurl+e.contractImgList[0].contractImgUrl,alt:""},nativeOn:{click:function(n){return t.jump(1,e.id)}}})],1)})),1)],1),n("el-card",{staticStyle:{width:"110%","margin-left":"-14px",height:"53%"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("签约看板")])]),n("div",{staticClass:"leftBoardContent",staticStyle:{height:"300px"}},[n("el-timeline",t._l(t.activities,(function(e,a){return n("el-timeline-item",{key:a,attrs:{icon:e.icon,type:e.type,color:e.color,size:e.size}},[n("p",{class:"1"==e.type?"color_red":"2"==e.type?"color_green":"3"==e.type?"color_gray":"",staticStyle:{"font-size":"8px!important"}},[t._v("【"+t._s(e.content)+"】")]),"2"!=e.type?n("p",{class:"1"==e.type?"color_red":"2"==e.type?"color_green":"3"==e.type?"color_gray":"",staticStyle:{"font-size":"7px!important"}},[t._v(t._s(t.parseTime(e.timestamp,"{y}年{m}月{d}日{h}:{m}:{s}")+t.statusdicts[e.type]))]):t._e(),"2"==e.type?n("p",{class:"1"==e.type?"color_red":"2"==e.type?"color_green":"3"==e.type?"color_gray":"",staticStyle:{"font-size":"7px!important"}},[t._v(t._s(t.parseTime(e.time,"{y}年{m}月{d}日{h}:{m}:{s}")+t.statusdicts[e.type]))]):t._e(),n("div",{staticStyle:{"border-bottom":"1px solid #e4e7ed",width:"89%"}})])})),1)],1)])],1),n("el-row",[n("el-button",{staticClass:"anniu",staticStyle:{padding:"13px 50px 13px 50px","margin-left":"30%","margin-top":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.goback}},[t._v("返回")])],1)],1),n("div",{staticClass:"pdfContent_1PW2f1"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isShow,expression:"!isShow"}],ref:"pdfBox",staticClass:"pdf-container",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.1)"}},[n("div",{staticClass:"pdf-box"},t._l(t.page_count,(function(e){return n("div",{key:e,staticClass:"pdfPage_1yRne"},[n("canvas",{staticClass:"the_canvas",style:{width:t.pdfWidth/2+"px",height:t.pdfHeight/2+"px"},attrs:{id:"the-canvas"+e}}),n("div",{staticClass:"dragLayer_3ccsq",attrs:{id:"can"+e}}),n("transition",{attrs:{name:"slide-fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showEdges,expression:"showEdges"}],staticClass:"es-pdf-page__edges",class:{"es-pdf-page__edges--visible":t.signEdges},staticStyle:{width:"120px"},style:{width:t.slideWidth+"px",height:t.pdfHeight/2+"px"},attrs:{id:"edge_"+e}})])],1)})),0),n("div",{staticClass:"bottom-btn1"},[n("span",[t._v("页码："),n("input",{directives:[{name:"model",rawName:"v-model",value:t.page_num,expression:"page_num"}],staticClass:"input-text",attrs:{type:"text",placeholder:"1"},domProps:{value:t.page_num},on:{input:function(e){e.target.composing||(t.page_num=e.target.value)}}}),t._v(" / "+t._s(t.page_count)+" ")]),n("el-button",{staticStyle:{"padding-left":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.jump(t.page_num,t.attach_id)}}},[t._v("跳转")])],1)])])])},c=[],o=(n("d3b7"),n("159b"),n("b0c0"),n("4ec9"),n("3ca3"),n("ddb0"),n("ac1f"),n("1276"),n("caad"),n("d055")),i=n.n(o),s=n("30c2"),r=n("adc1"),l=n("4d5c"),u=n("a958"),d="",h={data:function(){return{visible:!1,statusdict:["保存草稿","签约发起","签约完成","签约终止","签约终止"],statusdicts:["","正在填写","签约截止","发起","11"],baseurl:"/prod-api",activeNameLeft:"1",isShow:!1,setFlag:!1,showPerson:!1,sign_status:3,auth_status:1,is_cc:0,can_sign:0,signEdges:!1,showEdges:!1,signVisible:!1,faceVisible:!1,count:0,timer:null,dom:null,scrollTop:0,codeTimer:null,bizId:"",authUrl:"https://www.baidu.com/",qrSuccess:!1,scanSuccess:!1,faceActiveName:"1",pageNum:1,scale:1,page_num:0,page_count:0,maxscale:2,minscale:.5,pdfWidth:0,pdfHeight:0,slideWidth:120,right:!0,left:!0,code:"",mobile:"",pos_x:"",pos_y:"",posPage:"",seal_id:"",activities:[],commonStructsList:[],contract_info:{},contract_attach:[],attach_id:"",contract_img:[],contract_logs:[{statusDesc:"全部签署完成"}],person_seals:[],sign_auth_type:"",attach_idArr:"",contractId:"",signatoryId:"",signatoryType:"",heights:void 0,widths:void 0,arry:[]}},created:function(){this.contractId=this.$route.params.id,this.mobile=localStorage.getItem("siteMobile"),this.getParameter(),this.getData(),this.getHeights()},destroyed:function(){this.timer&&clearInterval(this.timer),this.codeTimer&&clearInterval(this.codeTimer)},mounted:function(){this.$nextTick((function(){this.$refs.pdfBox.addEventListener("scroll",this.handleScroll,!1)}))},watch:{scale:function(t,e){document.querySelectorAll(".mark").forEach((function(n){n.style.left=parseInt(n.style.left)/(e/t)+"px",n.style.top=parseInt(n.style.top)/(e/t)+"px",n.style.height=100*t+"px",n.style.width=100*t+"px"})),document.querySelectorAll(".text_mark").forEach((function(n){n.style.left=parseInt(n.style.left)/(e/t)+"px",n.style.top=parseInt(n.style.top)/(e/t)+"px",n.style.height=28*t+"px",n.style.width=190*t+"px"})),document.querySelectorAll(".text_mark2").forEach((function(n){n.style.left=parseInt(n.style.left)/(e/t)+"px",n.style.top=parseInt(n.style.top)/(e/t)+"px",n.style.height=100*t+"px",n.style.width=100*t+"px"})),this.slideWidth=120*t}},methods:{downcontact:function(t){var e=t.id;this.zipdownload(e,t.name)},reloadFun:function(){},handelChange:function(t){var e=this;0==this.arry.length&&this.contract_attach.forEach((function(t,n){e.arry.push(t.contractImgList.length)}));var n=0;if(t){for(var a=0;a<t;a++)n+=this.arry[a];this.jump(n+1)}else this.jump(1)},getHeights:function(){var t=document.documentElement.scrollWidth||document.body.scrollWidth;document.documentElement.clientHeight;this.widths=t-350-100-200,this.heights=30*this.widths/21},renderPage:function(t,e){var n=document.getElementById("the-canvas"+t),a=n.getContext("2d"),c=new Image;c.onload=function(){a.drawImage(c,100,0,n.width,n.height)},c.src=this.baseurl+e,this.pdfHeight=n.height=2*this.heights,this.pdfWidth=n.width=2*this.widths},getParameter:function(){var t=this;console.log("this.contractId",this.contractId),Object(r["e"])(this.contractId).then((function(e){200===e.code&&(t.contract_info=e.data)}))},toPerson:function(){this.showPerson=!0,window.open(this.fun.getSiteRoot()+"/#/real_people?i="+this.fun.getKeyByI())},onCopy:function(t){this.$message.success("复制成功")},onError:function(t){this.$message.error("复制失败")},close:function(){this.codeTimer&&clearInterval(this.codeTimer)},checkFace:function(){var t=this;setTimeout((function(){t.companySign()}),5e3),this.scanSuccess=!0,this.codeTimer&&clearInterval(this.codeTimer)},createQrc:function(){var t=this,e=this.authUrl;this.qrSuccess=!1,this.$nextTick((function(){d=document.getElementById("qrccode-canvas")})),setTimeout((function(){i.a.toCanvas(d,e,(function(e){e?(t.qrSuccess=!1,console.log(e)):(t.qrSuccess=!0,t.checkFace(),t.codeTimer=setInterval((function(){t.checkFace()}),5e3),console.log("success"))}))}),1e3)},tabClick:function(t){},sendCode:function(){},companySign:function(){var t=this;if(this.code||1!=this.sign_auth_type){var e=1;e=this.showEdges?2:1;1==this.sign_auth_type?{sign_type:e,total_page:this.page_count,posPage:this.posPage,seal_id:this.seal_id,width:100,pos_x:this.pos_x/this.scale,pos_y:this.pdfHeight/this.scale-this.pos_y/this.scale-100,updateTime:this.contract_info.updateTime,id:this.contractId,code:this.code}:{sign_type:e,total_page:this.page_count,posPage:this.posPage,seal_id:this.seal_id,width:100,pos_x:this.pos_x/this.scale,pos_y:this.pdfHeight/this.scale-this.pos_y/this.scale-100,updateTime:this.contract_info.updateTime,id:this.contractId,bizId:this.bizId},this.$alert("签署成功！  点击确认返回合同列表","签署成功",{type:"success",confirmButtonText:"确定",center:!0,callback:function(e){t.$router.push(t.fun.getUrl("Manage"))}})}else this.$message.error("请输入验证码")},getData:function(){var t=this;this.page_count=0,Object(s["d"])(this.contractId).then((function(e){if(200===e.code){t.contract_attach=e.data,t.attach_id=t.contract_attach[0].id,t.commonStructsList=[];for(var n=0;n<t.contract_attach.length;n++)if(t.page_count=t.page_count+t.contract_attach[n].contractImgList.length,t.contract_attach[n].signLocation)for(var a=JSON.parse(t.contract_attach[n].signLocation),c=0;c<a.length;c++)t.commonStructsList.push(a[c]);t.loadFile(),Object(l["a"])(t.contractId).then((function(e){if(200===e.code){for(var n=e.data,a=0;a<n.length;a++)t.sign_status=n[a].signStatus,"0"==t.sign_status&&""==t.signatoryId&&(t.signatoryId=n[a].id,t.signatoryType=n[a].signatoryType);"0"==t.sign_status&&(t.can_sign=1);var c={flag:"1"==t.signatoryType?"2":0};Object(s["f"])(c).then((function(e){200===e.code&&(t.person_seals=e.data)}))}}))}})),Object(u["d"])(this.contractId).then((function(e){if(200===e.code&&(t.contract_logs=e.data,console.log("this.contract_logs",t.contract_logs),t.contract_logs))for(var n=0;n<t.contract_logs.length;n++){var a=t.contract_logs[n].statusDesc,c=t.contract_logs[n].status,o="",i="",s=" ",r="";"0"==c?(o="el-icon-check",i="gray",s="3"):"1"==c?(o="el-icon-edit",i="#DC001E",s="1"):"2"==c?(o="el-icon-close",i="gray",s="3"):"3"==c?(o="el-icon-check",i="gray",s="3"):(i="#2fca34",o="el-icon-more-outline",s="2",r=t.contract_info.signEndDate),t.activities.push({content:a,timestamp:t.contract_logs[n].createTime,color:i,icon:o,size:"large",type:s,time:r})}})),this.showPerson=!1,this.auth_status=1,this.is_cc=0,this.sign_auth_type=1},TextMouseenter:function(t){t.currentTarget.childNodes[0].style.display="flex"},TextMouseleave:function(t){t.currentTarget.childNodes[0].style.display="none"},TextDeleteIt:function(t){document.querySelector(".dragLayer_3ccsq").removeChild(t.currentTarget.parentNode)},mouseenter:function(t){t.currentTarget.childNodes[0].style.display="block"},mouseleave:function(t){t.currentTarget.childNodes[0].style.display="none"},deleteIt:function(t){t.currentTarget.parentNode.parentNode.removeChild(t.currentTarget.parentNode)},deleteIt2:function(){document.querySelectorAll(".slide-sign").forEach((function(t){t.parentNode.removeChild(t)}))},delseallocation:function(t){t.currentTarget.parentNode.parentNode.childNodes[0].style.display="block",t.currentTarget.parentNode.parentNode.removeChild(t.currentTarget.parentNode)},delseallocationqf:function(t){var e=t.currentTarget.parentNode.parentNode.parentNode.id;document.querySelectorAll(".slide-location").forEach((function(t){t.id==e&&t.childNodes[1].removeChild(t.childNodes[1].childNodes[2])}))},getPos:function(t){return{x:t.clientX,y:t.clientY}},handleClick:function(t,e){},handleScroll:function(t){var e=this;this.scrollTop=this.$refs.pdfBox.scrollTop;var n=document.querySelectorAll(".pdfPage_1yRne"),a=[];n.forEach((function(t,n){e.scrollTop>=t.offsetTop&&a.push(n)})),this.page_num=Math.max.apply(null,a)+1},jump:function(t,e){var n=0;this.contract_attach.forEach((function(a,c){a.id!=e?n+=a.contractImgList.length:t=n+t}));var a=this,c=this.page_num-1;if(t&&(c=t-1),c>this.page_count)this.$message.error("请输入有效范围内的数字");else{var o=document.querySelectorAll(".pdfPage_1yRne"),i=o[c].offsetTop,s=this.scrollTop,r=i/30>>0;if(i>s)u();else{var l=s-i;r=l/30>>0,d()}}function u(){s<i?(s+=r,a.$refs.pdfBox.scrollTop=s,setTimeout(u,10)):a.$refs.pdfBox.scrollTop=i}function d(){s>i?(s-=r,a.$refs.pdfBox.scrollTop=s,setTimeout(d,10)):a.$refs.pdfBox.scrollTop=i}},loadFile:function(){var t=this;this.$nextTick((function(){t.pageNum=1,t.page_num=1,t.attach_idArr=new Map;for(var e=0;e<t.contract_attach.length;e++){var n=t.contract_attach[e].contractImgList;t.isShow=!0;for(var a=1;a<=n.length;a++){var c=n[a-1].contractImgUrl,o=n[a-1].seq;t.attach_idArr.set(t.pageNum,t.contract_attach[e].id+"||"+o),t.renderPage(t.pageNum,c),t.pageNum++}}}))},showSign:function(){var t=this;if(document.querySelectorAll(".mark").length<=0)this.$message.warning("该文件未指定签署位置，无法一键签约。");else{var e=[],n=[];document.querySelectorAll(".mark").forEach((function(a){var c=a.className,o=parseInt(a.getAttribute("page")),i=t.attach_idArr.get(o).split("||")[0],s=t.attach_idArr.get(o).split("||")[1];if(c.indexOf("slide-sign")>0){var r=parseInt(a.style.top)/t.scale;if(n.includes(r))return;n.push(r);var l={contractId:t.contractId,sealid:a.id,posX:parseInt(a.style.left)/t.scale,posY:parseInt(a.style.top)/t.scale,docPage:"paging",attachid:i,seq:s};e.push(l)}else{var u={contractId:t.contractId,sealid:a.id,posX:parseInt(a.style.left)/t.scale,posY:parseInt(a.style.top)/t.scale,docPage:o,attachid:i,seq:s};e.push(u)}})),this.isShow=!1,Object(s["g"])(e).then((function(e){if(200===e.code){var n={id:t.signatoryId,signStatus:"1",contractId:t.contractId};Object(l["e"])(n).then((function(e){200===e.code&&(t.msgSuccess("签署成功"),t.getData())}))}}))}},locationClick:function(t){},goback:function(){if(window.history.length<=1)return this.$router.push({path:"/"}),!1;this.$router.go(-1)}}},p=h,f=(n("5694"),n("0c7c")),g=Object(f["a"])(p,a,c,!1,null,"05705dad",null);e["default"]=g.exports},"30c2":function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"g",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return s})),n.d(e,"h",(function(){return r})),n.d(e,"f",(function(){return l})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return d}));var a=n("b775");function c(t){return Object(a["a"])({url:"/contract/attach/getinfo/"+t,method:"get"})}function o(t){return Object(a["a"])({url:"/contract/sign",method:"post",data:t})}function i(t){return Object(a["a"])({url:"/contract/attach/param",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/contract/attach",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/contract/attach",method:"put",data:t})}function l(t){return Object(a["a"])({url:"/sign/seal/getSealList",method:"get",params:t})}function u(t){return Object(a["a"])({url:"/contract/attach/getPic/"+t,method:"get"})}function d(t){return Object(a["a"])({url:"/contract/attach/perfect/"+t,method:"get"})}},"4ca2":function(t,e,n){},"4d5c":function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"a",(function(){return r}));var a=n("b775");function c(t){return Object(a["a"])({url:"/contract/signatory/"+t,method:"get"})}function o(t){return Object(a["a"])({url:"/contract/signatory/getSignatory/"+t,method:"get"})}function i(t){return Object(a["a"])({url:"/contract/signatory",method:"put",data:t})}function s(t){return Object(a["a"])({url:"/contract/signatory/updatebyone",method:"put",data:t})}function r(t){return Object(a["a"])({url:"/contract/signatory/getInfoSelf/"+t,method:"get"})}},5694:function(t,e,n){"use strict";n("4ca2")},a958:function(t,e,n){"use strict";n.d(e,"e",(function(){return c})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"f",(function(){return s})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return l}));var a=n("b775");function c(t){return Object(a["a"])({url:"/contract/logs/list",method:"get",params:t})}function o(t){return Object(a["a"])({url:"/contract/logs/"+t,method:"get"})}function i(t){return Object(a["a"])({url:"/contract/logs",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/contract/logs",method:"put",data:t})}function r(t){return Object(a["a"])({url:"/contract/logs/"+t,method:"delete"})}function l(t){return Object(a["a"])({url:"/contract/logs/export",method:"get",params:t})}},adc1:function(t,e,n){"use strict";n.d(e,"f",(function(){return c})),n.d(e,"e",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"h",(function(){return s})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return l})),n.d(e,"g",(function(){return u})),n.d(e,"d",(function(){return d}));var a=n("b775");function c(t){return Object(a["a"])({url:"/contract/info/list",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/contract/info/"+t,method:"get"})}function i(t){return Object(a["a"])({url:"/contract/info",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/contract/info",method:"put",data:t})}function r(t){return Object(a["a"])({url:"/contract/info/"+t,method:"delete"})}function l(t){return Object(a["a"])({url:"/contract/info/export",method:"get",params:t})}function u(t){return Object(a["a"])({url:"/contract/info/sendContract",method:"put",data:t})}function d(t){return Object(a["a"])({url:"/contract/info/count",method:"Get",data:t})}}}]);