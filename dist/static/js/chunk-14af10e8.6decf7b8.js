(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14af10e8"],{1432:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showContainer,expression:"showContainer"}],staticClass:"face-capture",attrs:{id:"face-capture"}},[i("p",{staticClass:"tip"},[t._v("请保持人像在取景框内")]),i("video",{attrs:{id:"video",width:t.vwidth,height:t.vheight,playsinline:"","webkit-playsinline":""}}),i("canvas",{attrs:{id:"refCanvas",width:t.cwidth,height:t.cheight}}),i("p",{staticClass:"contentp"},[t._v(t._s(t.scanTip))])]),t.showContainer?t._e():i("div",{staticClass:"img-face"},[i("img",{staticClass:"imgurl",attrs:{src:t.imgUrl}})])])},s=[];i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("159b"),i("ac1f"),i("1276"),i("ace4"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7");i("9db3"),i("81f4"),i("33ea"),i("f9ef");var n={data:function(){return{screenSize:{width:window.screen.width,height:window.screen.height},URL:null,streamIns:null,showContainer:!0,tracker:null,tipFlag:!1,flag:!1,context:null,profile:[],removePhotoID:null,scanTip:"人脸识别中...",imgUrl:"",canvas:null,trackertask:null,vwidth:"266",vheight:"266",cwidth:"266",cheight:"266",userInfo:{},orderData:{}}},mounted:function(){var t=this.screenSize.width/375;this.vwidth=266*t,this.vheight=266*t,this.cwidth=266*t,this.cheight=266*t,this.playVideo()},methods:{playVideo:function(){this.getUserMedia({video:{width:500,height:500,facingMode:"user"}},this.success,this.error)},getUserMedia:function(t,e,i){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(e).catch(i):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(t).then(e).catch(i):navigator.mozGetUserMedia?navagator.mozGetUserMedia(t).then(e).catch(i):navigator.getUserMedia?navigator.getUserMedia(t).then(e).catch(i):this.scanTip="你的浏览器不支持访问用户媒体设备"},success:function(t){var e=this;this.streamIns=t;var i=document.getElementById("video");this.URL=window.URL||window.webkitURL,"srcObject"in i?(i.srcObject=t,i.play()):i.src=this.URL.createObjectURL(t),setTimeout((function(){i.play(),e.initTracker()}),100)},error:function(t){this.scanTip="访问用户媒体失败"},initTracker:function(){var t=this;this.context=document.getElementById("refCanvas").getContext("2d"),this.canvas=document.getElementById("refCanvas"),this.tracker=new window.tracking.ObjectTracker("face"),this.tracker.setInitialScale(4),this.tracker.setStepSize(2),this.tracker.setEdgesDensity(.1);try{this.trackertask=window.tracking.track("#video",this.tracker)}catch(e){this.scanTip="访问用户媒体失败，请重试"}this.tracker.on("track",(function(e){t.context.clearRect(0,0,t.canvas.width,t.canvas.height),0===e.data.length?t.scanTip="未检测到人脸":(e.data.forEach((function(e){t.context.strokeStyle="#42e365",t.context.lineWidth=2,t.context.strokeRect(e.x,e.y,e.width,e.height)})),t.tipFlag||(t.scanTip="检测成功，正在拍照，请保持不动2秒"),t.flag||(t.scanTip="拍照中...",t.flag=!0,t.removePhotoID=setTimeout((function(){t.tackPhoto(),document.getElementById("video").pause(),t.tipFlag=!0}),1500)))}))},tackPhoto:function(){this.context.drawImage(document.getElementById("video"),0,0,this.vwidth,this.vwidth),this.imgUrl=this.saveAsPNG(document.getElementById("refCanvas")),this.imgSize(),this.close()},imgSize:function(){if(this.imgUrl){var t,e=this.imgUrl.indexOf("=");if(e>0){var i=this.imgUrl.substring(0,e),a=i.length,s=a-a/8*2;t=Math.floor(s/1024),console.log("size",t+"KB")}else{var n=this.imgUrl.length,c=n-n/8*2;t=Math.floor(c/1024),console.log("size",t+"KB")}t>1024&&(this.imgUrl=document.getElementById("refCanvas").toDataURL("image/png",1024/t))}},getBlobBydataURI:function(t,e){for(var i=window.atob(t.split(",")[1]),a=[],s=0;s<i.length;s++)a.push(i.charCodeAt(s));return new Blob([new Uint8Array(a)],{type:e})},saveAsPNG:function(t){return t.toDataURL("image/png",.4)},close:function(){this.flag=!1,this.tipFlag=!1,this.showContainer=!1,this.context=null,this.scanTip="人脸识别中...",clearTimeout(this.removePhotoID),this.streamIns&&(this.streamIns.enabled=!1,this.streamIns.getTracks()[0].stop(),this.streamIns.getVideoTracks()[0].stop()),this.streamIns=null,this.trackertask.stop(),this.tracker=null}}},c=n,r=(i("a5b0"),i("0c7c")),o=Object(r["a"])(c,a,s,!1,null,"f29e4326",null);e["default"]=o.exports},"6ff7":function(t,e,i){},a5b0:function(t,e,i){"use strict";i("6ff7")}}]);