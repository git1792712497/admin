var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(o,t,a)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[t]=a,i=(e,o)=>{for(var t in o||(o={}))l.call(o,t)&&n(e,t,o[t]);if(a)for(var t of a(o))s.call(o,t)&&n(e,t,o[t]);return e},r=(e,o,t)=>new Promise(((a,l)=>{var s=e=>{try{i(t.next(e))}catch(o){l(o)}},n=e=>{try{i(t.throw(e))}catch(o){l(o)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,n);i((t=t.apply(e,o)).next())}));import{a as d,B as c}from"./index-c9e02f09.js";import{u as m,B as p}from"./useForm-76a4ff23.js";import{g as u,b as f,c as b,d as y}from"./model-0b68421a.js";import{g as j}from"./datasource-efce687f.js";import{a as g,w as v,k as h,f as P,o as w,j as I,H as O,n as C,ag as q}from"./index-c5a6c875.js";import"./useWindowSizeFn-72c85a53.js";import"./FullscreenOutlined-9b414b92.js";import"./isEqual-f9888ec4.js";import"./_baseIsEqual-f0bca653.js";import"./index-bb91fa2a.js";import"./get-8f9589fb.js";import"./uuid-f62a8acd.js";import"./download-0641dcf7.js";import"./index-b52e0339.js";import"./uniqBy-e29b0e8a.js";const F=g({emits:["success","register"],setup(e,{emit:a}){const l=v(!0),s=v(""),n=[{field:"datasourceId",label:"数据源",component:"ApiSelect",componentProps:{api:j,labelField:"name",valueField:"id",getPopupContainer:()=>document.body,onChange:e=>r(this,null,(function*(){F({modelTable:""});const o=yield f({datasourceId:e});N({field:"modelTable",componentProps:{options:o}})}))},required:!0},{field:"modelTable",label:"物理表名",component:"Select",componentProps:{getPopupContainer:()=>document.body,fieldNames:{label:"comment",value:"name"},onChange:e=>r(this,null,(function*(){const o=R(),t=yield b({tableName:e,datasourceId:o.datasourceId}),{comment:a,entityName:l}=t;F({modelClass:l,modelName:a,modelCode:l.replace(/^\S/,(e=>e.toLowerCase()))})}))},required:!0},{field:"modelClass",label:"模型类名",component:"Input",required:!0},{field:"modelName",label:"模型名称",component:"Input",required:!0},{field:"modelCode",label:"模型编号",component:"Input",required:!0},{field:"modelRemark",label:"模型备注",component:"Input"}],[g,{setFieldsValue:F,resetFields:x,validate:S,updateSchema:N,getFieldsValue:R}]=m({labelWidth:100,schemas:n,showActionButtonGroup:!1,baseColProps:{span:12},actionColOptions:{span:23}}),[B,{setModalProps:L,closeModal:T}]=d((e=>r(this,null,(function*(){if(x(),L({confirmLoading:!1}),l.value=!!(null==e?void 0:e.isUpdate),h(l)){s.value=e.record.id;const o=yield u({id:e.record.id}),t=yield f({datasourceId:o.datasourceId});N({field:"modelTable",componentProps:{options:t}}),F(i({},o))}})))),k=P((()=>h(l)?"编辑":"新增"));function E(){return r(this,null,(function*(){try{const r=yield S();L({confirmLoading:!0}),h(l)&&(r.id=s.value),yield y(r),T(),a("success",{isUpdate:h(l),values:(e=i({},r),n={id:s.value},o(e,t(n)))})}finally{L({confirmLoading:!1})}var e,n}))}return(e,o)=>(w(),I(h(c),q(e.$attrs,{onRegister:h(B),title:h(k),onOk:E,width:900}),{default:O((()=>[C(h(p),{onRegister:h(g)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{F as default};
