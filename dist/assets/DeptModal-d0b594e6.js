var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,t,a)=>new Promise(((l,o)=>{var n=e=>{try{i(a.next(e))}catch(t){o(t)}},r=e=>{try{i(a.throw(e))}catch(t){o(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,r);i((a=a.apply(e,t)).next())}));import{y as r,cP as i,bj as d,a as s,w as p,k as c,f as u,o as m,j as f,H as b,E as y,G as g,i as v,n as h,ag as P}from"./index-c5a6c875.js";import{a as I,B as N}from"./index-c9e02f09.js";import{u as j,B as w}from"./useForm-76a4ff23.js";import{b as x,g as O}from"./system-54dc9bf1.js";import{u as k,D as C}from"./index-2c15cc4f.js";import{a as F,b as R,u as S}from"./dept-667428a4.js";const _=[{title:"机构名称",dataIndex:"deptName"},{title:"机构全称",dataIndex:"fullName"},{title:"所属租户",dataIndex:"tenantId",defaultHidden:!r.tenantMode},{title:"机构类型",dataIndex:"deptCategoryName",customRender:({record:e})=>{const t=e.deptCategoryName;return i(d,{color:"green"},(()=>t))}},{title:"排序",dataIndex:"sort",width:80}],q=[{field:"deptName",label:"机构名称",component:"Input",colProps:{span:8}},{field:"tenantId",label:"所属租户",component:"ApiSelect",show:r.tenantMode,componentProps:{api:x,labelField:"tenantName",valueField:"tenantId"},colProps:{span:8}},{field:"fullName",label:"机构全称",component:"Input",colProps:{span:8}}],B=[{field:"deptName",label:"机构名称",component:"Input",required:!0},{field:"fullName",label:"机构全称",component:"Input",required:!0},{field:"parentId",label:"上级机构",component:"TreeSelect",componentProps:{style:{width:"100%"},fieldNames:{label:"deptName",key:"id",value:"id"},getPopupContainer:()=>document.body},required:!0},{field:"deptCategory",label:"机构类型",component:"ApiSelect",componentProps:{style:{width:"100%"},api:O,params:{code:"org_category"},labelField:"dictValue",valueField:"dictKey",stringToNumber:!0},required:!0},{field:"sort",label:"排序",component:"InputNumber",componentProps:{style:{width:"100%"}},required:!0},{label:"备注",field:"remark",component:"InputTextArea"}],D=[{field:"deptName",label:"机构名称"},{field:"fullName",label:"机构全称"},{field:"parentName",label:"上级机构"},{field:"deptCategoryName",label:"机构类型"},{field:"sort",label:"排序"},{field:"remark",label:"备注"}],M=s({emits:["success","register"],setup(e,{emit:r}){const i=p(!0),d=p(!0),s=p(""),[x,{setDescProps:O}]=k({schema:D}),[_,{resetFields:q,setFieldsValue:M,updateSchema:A,validate:T}]=j({labelWidth:100,baseColProps:{span:24},schemas:B,showActionButtonGroup:!1}),[L,{setModalProps:z,closeModal:E}]=I((e=>n(this,null,(function*(){if(q(),i.value=!!(null==e?void 0:e.isUpdate),d.value=!!(null==e?void 0:e.isDetail),c(d)){const t=yield F({id:e.record.id});O({data:t})}else{let n=yield R();if(c(i)){const r=yield F({id:e.record.id});s.value=e.record.id,M(((e,n)=>{for(var r in n||(n={}))a.call(n,r)&&o(e,r,n[r]);if(t)for(var r of t(n))l.call(n,r)&&o(e,r,n[r]);return e})({},r)),n.unshift({deptName:"顶级",id:"0"})}e.addChild&&M({parentId:e.record.id}),A({field:"parentId",componentProps:{treeData:n}})}z({confirmLoading:!1})})))),G=u((()=>c(i)?"编辑机构":c(d)?"机构详情":"新增机构"));function H(){return n(this,null,(function*(){try{const e=yield T();z({confirmLoading:!0}),c(i)&&(e.id=s.value),yield S(e),E(),r("success")}finally{z({confirmLoading:!1})}}))}return(e,t)=>(m(),f(c(N),P(e.$attrs,{onRegister:c(L),title:c(G),showOkBtn:!d.value,onOk:H}),{default:b((()=>[y(v("div",null,[h(c(C),{size:"middle",onRegister:c(x),column:1},null,8,["onRegister"])],512),[[g,d.value]]),y(v("div",null,[h(c(w),{onRegister:c(_)},null,8,["onRegister"])],512),[[g,!d.value]])])),_:1},16,["onRegister","title","showOkBtn"]))}}),A=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{A as D,M as _,_ as c,q as s};
