var e=(e,a,t)=>new Promise(((l,c)=>{var s=e=>{try{i(t.next(e))}catch(a){c(a)}},o=e=>{try{i(t.throw(e))}catch(a){c(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,o);i((t=t.apply(e,a)).next())}));import{s as a,a as t,cY as l,w as c,f as s,ab as o,o as i,j as n,H as d,n as u,ag as r}from"./index-c5a6c875.js";import{B as p,a as m}from"./index-c9e02f09.js";import{_ as v}from"./index-941b9c74.js";import{a as f,b as S,s as y}from"./menu-b0618eaf.js";import"./useWindowSizeFn-72c85a53.js";import"./FullscreenOutlined-9b414b92.js";import"./isEqual-f9888ec4.js";import"./_baseIsEqual-f0bca653.js";import"./get-8f9589fb.js";const b=a(t({name:"RoleSettingModal",components:{BasicModal:p,BasicTree:v,Tabs:l,TabPane:l.TabPane},emits:["success","register","error"],setup(a,{emit:t}){const l=c(""),o=c([]),i=c([]),n=c([]),d=c([]),u=c([]),r=c([]),p=c("1"),[v,{setModalProps:b,closeModal:h}]=m((a=>e(this,null,(function*(){b({confirmLoading:!1}),l.value=null==a?void 0:a.id[0];const e=yield f();o.value=e.menu,i.value=e.dataScope,n.value=e.apiScope;const t=yield S({roleIds:l.value});u.value=t.menu,d.value=t.apiScope,r.value=t.dataScope})))),k=s((()=>"编辑权限"));return{handleSubmit:function(){return e(this,null,(function*(){try{b({confirmLoading:!0}),yield y({apiScopeIds:d.value,dataScopeIds:r.value,menuIds:u.value,roleIds:[l.value]}),h(),t("success")}finally{b({confirmLoading:!1})}}))},apiSelect:d,menuSelect:u,dataSelect:r,activeKey:p,apiScopeData:n,menuData:o,dataScopeData:i,apiScopeModal:v,getTitle:k}}}),[["render",function(e,a,t,l,c,s){const p=o("BasicTree"),m=o("TabPane"),v=o("Tabs"),f=o("BasicModal");return i(),n(f,r(e.$attrs,{onRegister:e.apiScopeModal,title:e.getTitle,width:400,height:800,onOk:e.handleSubmit}),{default:d((()=>[u(v,{activeKey:e.activeKey,"onUpdate:activeKey":a[3]||(a[3]=a=>e.activeKey=a)},{default:d((()=>[u(m,{key:"1",tab:"菜单权限"},{default:d((()=>[u(p,{value:e.menuSelect,"onUpdate:value":a[0]||(a[0]=a=>e.menuSelect=a),treeData:e.menuData,checkedKeys:e.menuSelect,fieldNames:{key:"id"},checkable:"",toolbar:""},null,8,["value","treeData","checkedKeys"])])),_:1}),u(m,{key:"2",tab:"数据权限","force-render":""},{default:d((()=>[u(p,{value:e.dataSelect,"onUpdate:value":a[1]||(a[1]=a=>e.dataSelect=a),treeData:e.dataScopeData,checkedKeys:e.dataSelect,fieldNames:{key:"id"},checkable:"",toolbar:""},null,8,["value","treeData","checkedKeys"])])),_:1}),u(m,{key:"3",tab:"接口权限"},{default:d((()=>[u(p,{value:e.apiSelect,"onUpdate:value":a[2]||(a[2]=a=>e.apiSelect=a),treeData:e.apiScopeData,checkedKeys:e.apiSelect,fieldNames:{key:"id"},checkable:"",toolbar:""},null,8,["value","treeData","checkedKeys"])])),_:1})])),_:1},8,["activeKey"])])),_:1},16,["onRegister","title","onOk"])}]]);export{b as default};
