var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,n=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&r(e,a,l[a]);if(o)for(var a of o(l))i.call(l,a)&&r(e,a,l[a]);return e},d=(e,l,a)=>new Promise(((o,t)=>{var i=e=>{try{n(a.next(e))}catch(l){t(l)}},r=e=>{try{n(a.throw(e))}catch(l){t(l)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,r);n((a=a.apply(e,l)).next())}));import{a as s,B as p}from"./index-c9e02f09.js";import{u as c,B as m}from"./useForm-76a4ff23.js";import{g as u}from"./system-54dc9bf1.js";import{m as b,g as f}from"./model-0b68421a.js";import{bo as v,a as g,w as P,k as y,f as I,o as N,j as h,H as j,n as F,ag as x}from"./index-c5a6c875.js";import{v as q}from"./validate-e879236f.js";const w=[{title:"模块名",dataIndex:"codeName"},{title:"模版类型",dataIndex:"templateType",customRender:({text:e})=>"crud"===e?"单表":"sub"===e?"主子表":"tree"===e?"树表":void 0},{title:"表名",dataIndex:"tableName"},{title:"服务名",dataIndex:"serviceName"},{title:"包名",dataIndex:"packageName"}],O=[{field:"codeName",label:"模块名",component:"Input",colProps:{span:8}},{field:"tableName",label:"表名",component:"Input",colProps:{span:8}},{field:"serviceName",label:"服务名",component:"Input",colProps:{span:8}}],S=[{label:"模型配置",field:"modelSetting",component:"Divider",colProps:{span:24}},{field:"modelId",label:"数据模型",component:"ApiSelect",componentProps:{api:b,labelField:"modelName",valueField:"id"},required:!0},{field:"codeName",label:"模块名",component:"Input",required:!0},{field:"serviceName",label:"服务名",component:"Input",required:!0},{field:"tableName",label:"表名",component:"Input",required:!0},{field:"tablePrefix",label:"表前缀",component:"Input",required:!0},{field:"pkName",label:"主键名",component:"Input",required:!0},{field:"packageName",label:"包名",component:"Input",required:!0},{label:"模版配置",field:"templateSetting",component:"Divider",colProps:{span:24}},{field:"templateType",label:"模版类型",component:"Select",componentProps:{options:[{label:"单表",value:"crud"},{label:"主子表",value:"sub"}]},required:!0},{field:"author",label:"作者信息",component:"Input",required:!0},{field:"subModelId",label:"子表模型",component:"ApiSelect",componentProps:{api:b,labelField:"modelName",valueField:"id"},show:({model:e})=>"sub"===e.templateType},{field:"subFkId",label:"子表外键",component:"Input",show:({model:e})=>"sub"===e.templateType},{label:"生成配置",field:"codingSetting",component:"Divider",colProps:{span:24}},{field:"baseMode",label:"基础业务",component:"ApiSelect",componentProps:{api:u,params:{code:"yes_no"},labelField:"dictValue",valueField:"dictKey",stringToNumber:!0},required:!0},{field:"wrapMode",label:"包装器",component:"ApiSelect",componentProps:{api:u,params:{code:"yes_no"},labelField:"dictValue",valueField:"dictKey",stringToNumber:!0},required:!0},{field:"feignMode",label:"远程调用",component:"ApiSelect",componentProps:{api:u,params:{code:"yes_no"},labelField:"dictValue",valueField:"dictKey",stringToNumber:!0},required:!0},{field:"apiPath",label:"后端生成路径",component:"Input",required:!0},{field:"webPath",label:"前端生成路径",component:"Input",required:!0}],T=e=>v.get({url:"/blade-develop/code/list",params:e},{joinParamsToUrl:!0,joinTime:!1}),_=e=>v.post({url:"/blade-develop/code/remove",params:e},{joinParamsToUrl:!0}),k=e=>v.post({url:"/blade-develop/code/gen-code",params:e},{joinParamsToUrl:!0}),M=e=>v.post({url:"/blade-develop/code/copy",params:e},{joinParamsToUrl:!0}),R=g({emits:["success","register"],setup(e,{emit:o}){const t=P(!0),i=P(""),[r,{setFieldsValue:u,resetFields:b,validate:g,updateSchema:w,getFieldsValue:O}]=c({labelWidth:100,schemas:S,showActionButtonGroup:!1,baseColProps:{span:12},actionColOptions:{span:23}}),[T,{setModalProps:_,closeModal:k}]=s((e=>d(this,null,(function*(){if(b(),_({confirmLoading:!1}),t.value=!!(null==e?void 0:e.isUpdate),w({field:"modelId",componentProps:{onChange:e=>d(this,null,(function*(){const l=O(),a=yield f({id:e}),{modelName:o,modelTable:t,modelCode:i}=a;u({tablePrefix:t.split("_")[0]+"_",tableName:t,codeName:o,serviceName:`blade-${i}`,pkName:"id",packageName:`org.springblade.${i}`}),q(l.subFkId)&&!q(l.tablePrefix)&&u({subFkId:t.replace(l.tablePrefix,"")+"_id"})}))}}),y(t)){i.value=e.record.id,_({showOkBtn:!0});const a=yield(l={id:e.record.id},v.get({url:"/blade-develop/code/detail",params:l}));u(n({},a))}var l})))),M=I((()=>y(t)?"编辑":"新增"));function R(){return d(this,null,(function*(){try{const s=yield g();s.codeStyle="lemon",_({confirmLoading:!0}),y(t)&&(s.id=i.value),yield(d=s,v.post({url:"/blade-develop/code/submit",params:d},{isReturnNativeResponse:!0})),k(),o("success",{isUpdate:y(t),values:(e=n({},s),r={id:i.value},l(e,a(r)))})}finally{_({confirmLoading:!1})}var e,r,d}))}return(e,l)=>(N(),h(y(p),x(e.$attrs,{onRegister:y(T),title:y(M),onOk:R,width:1200}),{default:j((()=>[F(y(m),{onRegister:y(r)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}}),A=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));export{A as C,R as _,k as a,M as b,w as c,T as g,_ as r,O as s};
