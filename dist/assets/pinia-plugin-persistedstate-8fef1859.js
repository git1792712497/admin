function m(e){return typeof e=="object"&&e!==null}function f(e,t){return e=m(e)?e:Object.create(null),new Proxy(e,{get(n,r,l){return r==="key"?Reflect.get(n,r,l):Reflect.get(n,r,l)||Reflect.get(t,r,l)}})}function R(e,t){return t.reduce((n,r)=>n==null?void 0:n[r],e)}function _(e,t,n){return t.slice(0,-1).reduce((r,l)=>/^(__proto__)$/.test(l)?{}:r[l]=r[l]||{},e)[t[t.length-1]]=n,e}function $(e,t){return t.reduce((n,r)=>{const l=r.split(".");return _(n,l,R(e,l))},{})}function d(e,{storage:t,serializer:n,key:r,debug:l}){try{const u=t==null?void 0:t.getItem(r);u&&e.$patch(n==null?void 0:n.deserialize(u))}catch(u){l&&console.error(u)}}function y(e,{storage:t,serializer:n,key:r,paths:l,debug:u}){try{const o=Array.isArray(l)?$(e,l):e;t.setItem(r,n.serialize(o))}catch(o){u&&console.error(o)}}function v(e={}){return t=>{const{options:{persist:n},store:r}=t;if(!n)return;const l=(Array.isArray(n)?n.map(u=>f(u,e)):[f(n,e)]).map(({storage:u=localStorage,beforeRestore:o=null,afterRestore:i=null,serializer:c={serialize:JSON.stringify,deserialize:JSON.parse},key:s=r.$id,paths:g=null,debug:h=!1})=>{var a;return{storage:u,beforeRestore:o,afterRestore:i,serializer:c,key:((a=e.key)!=null?a:S=>S)(s),paths:g,debug:h}});l.forEach(u=>{const{beforeRestore:o,afterRestore:i}=u;o==null||o(t),d(r,u),i==null||i(t),r.$subscribe((c,s)=>{y(s,u)},{detached:!0})}),r.$persist=()=>{l.forEach(u=>{y(r.$state,u)})},r.$hydrate=({runHooks:u=!0}={})=>{l.forEach(o=>{const{beforeRestore:i,afterRestore:c}=o;u&&(i==null||i(t)),d(r,o),u&&(c==null||c(t))})}}}var b=v();export{b as s};
