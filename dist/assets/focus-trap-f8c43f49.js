var ce=Object.defineProperty,ae=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var W=(e,t,n)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,L=(e,t)=>{for(var n in t||(t={}))ie.call(t,n)&&W(e,n,t[n]);if(M)for(var n of M(t))fe.call(t,n)&&W(e,n,t[n]);return e},O=(e,t)=>ae(e,ue(t));var j=(e,t,n)=>new Promise((o,c)=>{var a=f=>{try{v(n.next(f))}catch(T){c(T)}},l=f=>{try{v(n.throw(f))}catch(T){c(T)}},v=f=>f.done?o(f.value):Promise.resolve(f.value).then(a,l);v((n=n.apply(e,t)).next())});import{r as de}from"./base-27e822c2.js";import{l as I,aW as A,Y as S,d as le,X as ve,w as R,u as _,n as Y,f as pe,r as Ee}from"./runtime-core.esm-bundler-76eda81d.js";import{_ as me}from"./plugin-vue_export-helper-529fb311.js";import{c as J}from"./index-e961436e.js";import{E as se}from"./index-10373a61.js";let m=[];const X=e=>{const t=e;t.key===se.esc&&m.forEach(n=>n(t))},Te=e=>{I(()=>{m.length===0&&document.addEventListener("keydown",X),J.isClient&&m.push(e)}),A(()=>{m=m.filter(t=>t!==e),m.length===0&&J.isClient&&document.removeEventListener("keydown",X)})},N="focus-trap.focus-after-trapped",k="focus-trap.focus-after-released",Fe="focus-trap.focusout-prevented",z={cancelable:!0,bubbles:!1},_e={cancelable:!0,bubbles:!1},G="focusAfterTrapped",Q="focusAfterReleased",be=Symbol("elFocusTrap"),U=S(),h=S(0),K=S(0);let b=0;const oe=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const c=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||c?NodeFilter.FILTER_SKIP:o.tabIndex>=0||o===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},Z=(e,t)=>{for(const n of e)if(!ye(n,t))return n},ye=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},Pe=e=>{const t=oe(e),n=Z(t,e),o=Z(t.reverse(),e);return[n,o]},Se=e=>e instanceof HTMLInputElement&&"select"in e,E=(e,t)=>{if(e&&e.focus){const n=document.activeElement;if(e.focus({preventScroll:!0}),K.value=window.performance.now(),e!==n&&Se(e)&&t){if(e.tagName==="INPUT"){e.setSelectionRange(e.value.length,e.value.length);return}e.select()}}};function ee(e,t){const n=[...e],o=e.indexOf(t);return o!==-1&&n.splice(o,1),n}const he=()=>{let e=[];return{push:o=>{const c=e[0];c&&o!==c&&c.pause(),e=ee(e,o),e.unshift(o)},remove:o=>{var c,a;e=ee(e,o),(a=(c=e[0])==null?void 0:c.resume)==null||a.call(c)}}},ge=(e,t=!1)=>{const n=document.activeElement;for(const o of e)if(E(o,t),document.activeElement!==n)return},te=he(),we=()=>h.value>K.value,y=()=>{U.value="pointer",h.value=window.performance.now()},ne=()=>{U.value="keyboard",h.value=window.performance.now()},Ce=()=>(I(()=>{b===0&&(document.addEventListener("mousedown",y),document.addEventListener("touchstart",y),document.addEventListener("keydown",ne)),b++}),A(()=>{b--,b<=0&&(document.removeEventListener("mousedown",y),document.removeEventListener("touchstart",y),document.removeEventListener("keydown",ne))}),{focusReason:U,lastUserFocusTimestamp:h,lastAutomatedFocusTimestamp:K}),P=e=>new CustomEvent(Fe,O(L({},_e),{detail:e})),Le=le({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[G,Q,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=S();let o,c;const{focusReason:a}=Ce();Te(s=>{e.trapped&&!l.paused&&t("release-requested",s)});const l={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},v=s=>{if(!e.loop&&!e.trapped||l.paused)return;const{key:r,altKey:u,ctrlKey:i,metaKey:d,currentTarget:B,shiftKey:$}=s,{loop:q}=e,re=r===se.tab&&!u&&!i&&!d,F=document.activeElement;if(re&&F){const g=B,[w,C]=Pe(g);if(w&&C){if(!$&&F===C){const p=P({focusReason:a.value});t("focusout-prevented",p),p.defaultPrevented||(s.preventDefault(),q&&E(w,!0))}else if($&&[w,g].includes(F)){const p=P({focusReason:a.value});t("focusout-prevented",p),p.defaultPrevented||(s.preventDefault(),q&&E(C,!0))}}else if(F===g){const p=P({focusReason:a.value});t("focusout-prevented",p),p.defaultPrevented||s.preventDefault()}}};ve(be,{focusTrapRef:n,onKeydown:v}),R(()=>e.focusTrapEl,s=>{s&&(n.value=s)},{immediate:!0}),R([n],([s],[r])=>{s&&(s.addEventListener("keydown",v),s.addEventListener("focusin",D),s.addEventListener("focusout",x)),r&&(r.removeEventListener("keydown",v),r.removeEventListener("focusin",D),r.removeEventListener("focusout",x))});const f=s=>{t(G,s)},T=s=>t(Q,s),D=s=>{const r=_(n);if(!r)return;const u=s.target,i=s.relatedTarget,d=u&&r.contains(u);e.trapped||i&&r.contains(i)||(o=i),d&&t("focusin",s),!l.paused&&e.trapped&&(d?c=u:E(c,!0))},x=s=>{const r=_(n);if(!(l.paused||!r))if(e.trapped){const u=s.relatedTarget;!de.isNil(u)&&!r.contains(u)&&setTimeout(()=>{if(!l.paused&&e.trapped){const i=P({focusReason:a.value});t("focusout-prevented",i),i.defaultPrevented||E(c,!0)}},0)}else{const u=s.target;u&&r.contains(u)||t("focusout",s)}};function H(){return j(this,null,function*(){yield Y();const s=_(n);if(s){te.push(l);const r=s.contains(document.activeElement)?o:document.activeElement;if(o=r,!s.contains(r)){const i=new Event(N,z);s.addEventListener(N,f),s.dispatchEvent(i),i.defaultPrevented||Y(()=>{let d=e.focusStartEl;pe(d)||(E(d),document.activeElement!==d&&(d="first")),d==="first"&&ge(oe(s),!0),(document.activeElement===r||d==="container")&&E(s)})}}})}function V(){const s=_(n);if(s){s.removeEventListener(N,f);const r=new CustomEvent(k,O(L({},z),{detail:{focusReason:a.value}}));s.addEventListener(k,T),s.dispatchEvent(r),!r.defaultPrevented&&(a.value=="keyboard"||!we())&&E(o!=null?o:document.body,!0),s.removeEventListener(k,f),te.remove(l)}}return I(()=>{e.trapped&&H(),R(()=>e.trapped,s=>{s?H():V()})}),A(()=>{e.trapped&&V()}),{onKeydown:v}}});function Oe(e,t,n,o,c,a){return Ee(e.$slots,"default",{handleKeydown:e.onKeydown})}var De=me(Le,[["render",Oe],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{De as E,be as F};
