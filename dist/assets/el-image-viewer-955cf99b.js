var Ee=Object.defineProperty,ze=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ve=(o,r,n)=>r in o?Ee(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,H=(o,r)=>{for(var n in r||(r={}))Se.call(r,n)&&ve(o,n,r[n]);if(me)for(var n of me(r))xe.call(r,n)&&ve(o,n,r[n]);return o},ee=(o,r)=>ze(o,Ce(r));var pe=(o,r,n)=>new Promise((f,E)=>{var w=p=>{try{l(n.next(p))}catch(m){E(m)}},Y=p=>{try{l(n.throw(p))}catch(m){E(m)}},l=p=>p.done?f(p.value):Promise.resolve(p.value).then(w,Y);l((n=n.apply(o,r)).next())});import{a as D}from"./index-f7939e7d.js";import{n as Oe,m as Te,T as Ne}from"./runtime-dom.esm-bundler-5921b3d0.js";import{b as we,d as re,r as le,k as Ae,w as ye}from"./base-c9ac7f1d.js";import{E as O}from"./index-f2930724.js";import{k as $e,s as Me,c as Ve,n as Be,b as De,o as Ye,z as Re,r as Fe,p as Pe}from"./index-0fe2b22d.js";import{m as he}from"./typescript-defaf979.js";import{i as B,A as fe,m as Xe}from"./index-e4b86012.js";import{u as ke,_ as be}from"./plugin-vue_export-helper-2c43b310.js";import{u as Ie,a as He,E as V}from"./index-af263c7f.js";import{d as ae,a4 as ge,Y as b,a3 as Ze,T as je,U as I,w as ie,n as _e,l as Le,o as _,c as ue,e as d,b as C,_ as g,ao as v,u as e,aq as ce,aB as L,Z as T,F as de,b5 as qe,b3 as We,bl as Ge,r as te,aw as Ke,bd as Ue,aR as Je,ar as Qe,f as et}from"./runtime-core.esm-bundler-763b24c9.js";import{u as tt}from"./index-d49e62b3.js";import{i as at}from"./position-c2cea7c0.js";import{i as st}from"./style-be20bb62.js";import{g as nt}from"./scroll-6da5dc64.js";const ot=()=>B&&/firefox/i.test(window.navigator.userAgent),lt=we({urlList:{type:re(Array),default:()=>he([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),rt={close:()=>!0,switch:o=>fe(o)},it=["src"],ut=ae({name:"ElImageViewer"}),ct=ae(ee(H({},ut),{props:lt,emits:rt,setup(o,{expose:r,emit:n}){const f=o,E={CONTAIN:{name:"contain",icon:ge($e)},ORIGINAL:{name:"original",icon:ge(Me)}},w=ot()?"DOMMouseScroll":"mousewheel",{t:Y}=Ie(),l=ke("image-viewer"),{nextZIndex:p}=He(),m=b(),z=b([]),A=Ze(),y=b(!0),c=b(f.initialIndex),$=je(E.CONTAIN),u=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),R=I(()=>{const{urlList:t}=f;return t.length<=1}),Z=I(()=>c.value===0),j=I(()=>c.value===f.urlList.length-1),F=I(()=>f.urlList[c.value]),se=I(()=>{const{scale:t,deg:s,offsetX:i,offsetY:h,enableTransition:S}=u.value;let k=i/t,x=h/t;switch(s%360){case 90:case-270:[k,x]=[x,-k];break;case 180:case-180:[k,x]=[-k,-x];break;case 270:case-90:[k,x]=[-x,k];break}const M={transform:`scale(${t}) rotate(${s}deg) translate(${k}px, ${x}px)`,transition:S?"transform .3s":""};return $.value.name===E.CONTAIN.name&&(M.maxWidth=M.maxHeight="100%"),M}),q=I(()=>fe(f.zIndex)?f.zIndex:p());function N(){oe(),n("close")}function ne(){const t=le.throttle(i=>{switch(i.code){case V.esc:f.closeOnPressEscape&&N();break;case V.space:U();break;case V.left:J();break;case V.up:a("zoomIn");break;case V.right:Q();break;case V.down:a("zoomOut");break}}),s=le.throttle(i=>{(i.wheelDelta?i.wheelDelta:-i.detail)>0?a("zoomIn",{zoomRate:1.2,enableTransition:!1}):a("zoomOut",{zoomRate:1.2,enableTransition:!1})});A.run(()=>{D(document,"keydown",t),D(document,w,s)})}function oe(){A.stop()}function W(){y.value=!1}function G(t){y.value=!1,t.target.alt=Y("el.image.error")}function K(t){if(y.value||t.button!==0||!m.value)return;u.value.enableTransition=!1;const{offsetX:s,offsetY:i}=u.value,h=t.pageX,S=t.pageY,k=le.throttle(M=>{u.value=ee(H({},u.value),{offsetX:s+M.pageX-h,offsetY:i+M.pageY-S})}),x=D(document,"mousemove",k);D(document,"mouseup",()=>{x()}),t.preventDefault()}function P(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function U(){if(y.value)return;const t=Ae(E),s=Object.values(E),i=$.value.name,S=(s.findIndex(k=>k.name===i)+1)%t.length;$.value=E[t[S]],P()}function X(t){const s=f.urlList.length;c.value=(t+s)%s}function J(){Z.value&&!f.infinite||X(c.value-1)}function Q(){j.value&&!f.infinite||X(c.value+1)}function a(t,s={}){if(y.value)return;const{zoomRate:i,rotateDeg:h,enableTransition:S}=H({zoomRate:1.4,rotateDeg:90,enableTransition:!0},s);switch(t){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/i).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*i).toFixed(3)));break;case"clockwise":u.value.deg+=h;break;case"anticlockwise":u.value.deg-=h;break}u.value.enableTransition=S}return ie(F,()=>{_e(()=>{const t=z.value[0];t!=null&&t.complete||(y.value=!0)})}),ie(c,t=>{P(),n("switch",t)}),Le(()=>{var t,s;ne(),(s=(t=m.value)==null?void 0:t.focus)==null||s.call(t)}),r({setActiveItem:X}),(t,s)=>(_(),ue(Ke,{to:"body",disabled:!t.teleported},[d(Ne,{name:"viewer-fade",appear:""},{default:C(()=>[g("div",{ref_key:"wrapper",ref:m,tabindex:-1,class:v(e(l).e("wrapper")),style:ce({zIndex:e(q)})},[g("div",{class:v(e(l).e("mask")),onClick:s[0]||(s[0]=Oe(i=>t.hideOnClickModal&&N(),["self"]))},null,2),L(" CLOSE "),g("span",{class:v([e(l).e("btn"),e(l).e("close")]),onClick:N},[d(e(O),null,{default:C(()=>[d(e(Ve))]),_:1})],2),L(" ARROW "),e(R)?L("v-if",!0):(_(),T(de,{key:0},[g("span",{class:v([e(l).e("btn"),e(l).e("prev"),e(l).is("disabled",!t.infinite&&e(Z))]),onClick:J},[d(e(O),null,{default:C(()=>[d(e(Be))]),_:1})],2),g("span",{class:v([e(l).e("btn"),e(l).e("next"),e(l).is("disabled",!t.infinite&&e(j))]),onClick:Q},[d(e(O),null,{default:C(()=>[d(e(De))]),_:1})],2)],64)),L(" ACTIONS "),g("div",{class:v([e(l).e("btn"),e(l).e("actions")])},[g("div",{class:v(e(l).e("actions__inner"))},[d(e(O),{onClick:s[1]||(s[1]=i=>a("zoomOut"))},{default:C(()=>[d(e(Ye))]),_:1}),d(e(O),{onClick:s[2]||(s[2]=i=>a("zoomIn"))},{default:C(()=>[d(e(Re))]),_:1}),g("i",{class:v(e(l).e("actions__divider"))},null,2),d(e(O),{onClick:U},{default:C(()=>[(_(),ue(qe(e($).icon)))]),_:1}),g("i",{class:v(e(l).e("actions__divider"))},null,2),d(e(O),{onClick:s[3]||(s[3]=i=>a("anticlockwise"))},{default:C(()=>[d(e(Fe))]),_:1}),d(e(O),{onClick:s[4]||(s[4]=i=>a("clockwise"))},{default:C(()=>[d(e(Pe))]),_:1})],2)],2),L(" CANVAS "),g("div",{class:v(e(l).e("canvas"))},[(_(!0),T(de,null,We(t.urlList,(i,h)=>Ge((_(),T("img",{ref_for:!0,ref:S=>z.value[h]=S,key:i,src:i,style:ce(e(se)),class:v(e(l).e("img")),onLoad:W,onError:G,onMousedown:K},null,46,it)),[[Te,h===c.value]])),128))],2),te(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var dt=be(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const ft=ye(dt),mt=we({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:re([String,Object])},previewSrcList:{type:re(Array),default:()=>he([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),vt={load:o=>o instanceof Event,error:o=>o instanceof Event,switch:o=>fe(o),close:()=>!0,show:()=>!0},pt=["src","loading"],gt={key:0},wt=ae({name:"ElImage",inheritAttrs:!1}),yt=ae(ee(H({},wt),{props:mt,emits:vt,setup(o,{emit:r}){const n=o;let f="";const{t:E}=Ie(),w=ke("image"),Y=Ue(),l=tt(),p=b(),m=b(!1),z=b(!0),A=b(!1),y=b(),c=b(),$=B&&"loading"in HTMLImageElement.prototype;let u,R;const Z=I(()=>Y.style),j=I(()=>{const{fit:a}=n;return B&&a?{objectFit:a}:{}}),F=I(()=>{const{previewSrcList:a}=n;return Array.isArray(a)&&a.length>0}),se=I(()=>{const{previewSrcList:a,initialIndex:t}=n;let s=t;return t>a.length-1&&(s=0),s}),q=I(()=>n.loading==="eager"?!1:!$&&n.loading==="lazy"||n.lazy),N=()=>{!B||(z.value=!0,m.value=!1,p.value=n.src)};function ne(a){z.value=!1,m.value=!1,r("load",a)}function oe(a){z.value=!1,m.value=!0,r("error",a)}function W(){at(y.value,c.value)&&(N(),P())}const G=Xe(W,200);function K(){return pe(this,null,function*(){var a;if(!B)return;yield _e();const{scrollContainer:t}=n;st(t)?c.value=t:et(t)&&t!==""?c.value=(a=document.querySelector(t))!=null?a:void 0:y.value&&(c.value=nt(y.value)),c.value&&(u=D(c,"scroll",G),setTimeout(()=>W(),100))})}function P(){!B||!c.value||!G||(u==null||u(),c.value=void 0)}function U(a){if(!!a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function X(){!F.value||(R=D("wheel",U,{passive:!1}),f=document.body.style.overflow,document.body.style.overflow="hidden",A.value=!0,r("show"))}function J(){R==null||R(),document.body.style.overflow=f,A.value=!1,r("close")}function Q(a){r("switch",a)}return ie(()=>n.src,()=>{q.value?(z.value=!0,m.value=!1,P(),K()):N()}),Le(()=>{q.value?K():N()}),(a,t)=>(_(),T("div",{ref_key:"container",ref:y,class:v([e(w).b(),a.$attrs.class]),style:ce(e(Z))},[p.value!==void 0&&!m.value?(_(),T("img",Je({key:0},e(l),{src:p.value,loading:a.loading,style:e(j),class:[e(w).e("inner"),e(F)&&e(w).e("preview"),z.value&&e(w).is("loading")],onClick:X,onLoad:ne,onError:oe}),null,16,pt)):L("v-if",!0),z.value||m.value?(_(),T("div",{key:1,class:v(e(w).e("wrapper"))},[z.value?te(a.$slots,"placeholder",{key:0},()=>[g("div",{class:v(e(w).e("placeholder"))},null,2)]):m.value?te(a.$slots,"error",{key:1},()=>[g("div",{class:v(e(w).e("error"))},Qe(e(E)("el.image.error")),3)]):L("v-if",!0)],2)):L("v-if",!0),e(F)?(_(),T(de,{key:2},[A.value?(_(),ue(e(ft),{key:0,"z-index":a.zIndex,"initial-index":e(se),infinite:a.infinite,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:J,onSwitch:Q},{default:C(()=>[a.$slots.viewer?(_(),T("div",gt,[te(a.$slots,"viewer")])):L("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],6))}}));var ht=be(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Mt=ye(ht);export{Mt as E};
