var _e=Object.defineProperty,Le=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var fe=(o,r,n)=>r in o?_e(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,X=(o,r)=>{for(var n in r||(r={}))Ce.call(r,n)&&fe(o,n,r[n]);if(de)for(var n of de(r))ze.call(r,n)&&fe(o,n,r[n]);return o},Q=(o,r)=>Le(o,Ee(r));var ve=(o,r,n)=>new Promise((v,C)=>{var y=g=>{try{l(n.next(g))}catch(m){C(m)}},B=g=>{try{l(n.throw(g))}catch(m){C(m)}},l=g=>g.done?v(g.value):Promise.resolve(g.value).then(y,B);l((n=n.apply(o,r)).next())});import{c as f}from"./index-e961436e.js";import{n as xe,m as Se,T as Te}from"./runtime-dom.esm-bundler-eeabfc76.js";import{b as pe,d as le,r as oe,k as Ne,w as ge}from"./base-27e822c2.js";import{E as N}from"./index-99ad55f3.js";import{k as Oe,s as $e,c as Ae,n as Me,b as Ve,o as De,z as Be,r as Ye,p as Fe}from"./index-3b581194.js";import{m as we}from"./typescript-defaf979.js";import{u as ye,_ as he}from"./plugin-vue_export-helper-529fb311.js";import{u as ke,a as Re,E as D}from"./index-10373a61.js";import{d as te,a4 as me,Y as I,a3 as Pe,T as Xe,U as _,w as re,n as be,l as Ie,o as L,c as ie,e as d,b as x,_ as w,aq as p,u as e,as as ue,aD as E,Z as O,F as ce,b7 as He,b5 as Ze,bn as je,r as ee,ay as qe,bf as We,aT as Ge,at as Ke,f as Ue}from"./runtime-core.esm-bundler-76eda81d.js";import{u as Je}from"./index-f12c72ea.js";import{i as Qe}from"./position-1ef43fb2.js";import{i as et}from"./style-e1000a00.js";import{g as tt}from"./scroll-38214788.js";const at=()=>f.isClient&&/firefox/i.test(window.navigator.userAgent),st=pe({urlList:{type:le(Array),default:()=>we([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),nt={close:()=>!0,switch:o=>f.isNumber(o)},ot=["src"],lt=te({name:"ElImageViewer"}),rt=te(Q(X({},lt),{props:st,emits:nt,setup(o,{expose:r,emit:n}){const v=o,C={CONTAIN:{name:"contain",icon:me(Oe)},ORIGINAL:{name:"original",icon:me($e)}},y=at()?"DOMMouseScroll":"mousewheel",{t:B}=ke(),l=ye("image-viewer"),{nextZIndex:g}=Re(),m=I(),z=I([]),A=Pe(),h=I(!0),c=I(v.initialIndex),M=Xe(C.CONTAIN),u=I({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),Y=_(()=>{const{urlList:t}=v;return t.length<=1}),H=_(()=>c.value===0),Z=_(()=>c.value===v.urlList.length-1),F=_(()=>v.urlList[c.value]),ae=_(()=>{const{scale:t,deg:s,offsetX:i,offsetY:k,enableTransition:S}=u.value;let b=i/t,T=k/t;switch(s%360){case 90:case-270:[b,T]=[T,-b];break;case 180:case-180:[b,T]=[-b,-T];break;case 270:case-90:[b,T]=[-T,b];break}const V={transform:`scale(${t}) rotate(${s}deg) translate(${b}px, ${T}px)`,transition:S?"transform .3s":""};return M.value.name===C.CONTAIN.name&&(V.maxWidth=V.maxHeight="100%"),V}),j=_(()=>f.isNumber(v.zIndex)?v.zIndex:g());function $(){ne(),n("close")}function se(){const t=oe.throttle(i=>{switch(i.code){case D.esc:v.closeOnPressEscape&&$();break;case D.space:K();break;case D.left:U();break;case D.up:a("zoomIn");break;case D.right:J();break;case D.down:a("zoomOut");break}}),s=oe.throttle(i=>{(i.wheelDelta?i.wheelDelta:-i.detail)>0?a("zoomIn",{zoomRate:1.2,enableTransition:!1}):a("zoomOut",{zoomRate:1.2,enableTransition:!1})});A.run(()=>{f.useEventListener(document,"keydown",t),f.useEventListener(document,y,s)})}function ne(){A.stop()}function q(){h.value=!1}function W(t){h.value=!1,t.target.alt=B("el.image.error")}function G(t){if(h.value||t.button!==0||!m.value)return;u.value.enableTransition=!1;const{offsetX:s,offsetY:i}=u.value,k=t.pageX,S=t.pageY,b=oe.throttle(V=>{u.value=Q(X({},u.value),{offsetX:s+V.pageX-k,offsetY:i+V.pageY-S})}),T=f.useEventListener(document,"mousemove",b);f.useEventListener(document,"mouseup",()=>{T()}),t.preventDefault()}function R(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function K(){if(h.value)return;const t=Ne(C),s=Object.values(C),i=M.value.name,S=(s.findIndex(b=>b.name===i)+1)%t.length;M.value=C[t[S]],R()}function P(t){const s=v.urlList.length;c.value=(t+s)%s}function U(){H.value&&!v.infinite||P(c.value-1)}function J(){Z.value&&!v.infinite||P(c.value+1)}function a(t,s={}){if(h.value)return;const{zoomRate:i,rotateDeg:k,enableTransition:S}=X({zoomRate:1.4,rotateDeg:90,enableTransition:!0},s);switch(t){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/i).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*i).toFixed(3)));break;case"clockwise":u.value.deg+=k;break;case"anticlockwise":u.value.deg-=k;break}u.value.enableTransition=S}return re(F,()=>{be(()=>{const t=z.value[0];t!=null&&t.complete||(h.value=!0)})}),re(c,t=>{R(),n("switch",t)}),Ie(()=>{var t,s;se(),(s=(t=m.value)==null?void 0:t.focus)==null||s.call(t)}),r({setActiveItem:P}),(t,s)=>(L(),ie(qe,{to:"body",disabled:!t.teleported},[d(Te,{name:"viewer-fade",appear:""},{default:x(()=>[w("div",{ref_key:"wrapper",ref:m,tabindex:-1,class:p(e(l).e("wrapper")),style:ue({zIndex:e(j)})},[w("div",{class:p(e(l).e("mask")),onClick:s[0]||(s[0]=xe(i=>t.hideOnClickModal&&$(),["self"]))},null,2),E(" CLOSE "),w("span",{class:p([e(l).e("btn"),e(l).e("close")]),onClick:$},[d(e(N),null,{default:x(()=>[d(e(Ae))]),_:1})],2),E(" ARROW "),e(Y)?E("v-if",!0):(L(),O(ce,{key:0},[w("span",{class:p([e(l).e("btn"),e(l).e("prev"),e(l).is("disabled",!t.infinite&&e(H))]),onClick:U},[d(e(N),null,{default:x(()=>[d(e(Me))]),_:1})],2),w("span",{class:p([e(l).e("btn"),e(l).e("next"),e(l).is("disabled",!t.infinite&&e(Z))]),onClick:J},[d(e(N),null,{default:x(()=>[d(e(Ve))]),_:1})],2)],64)),E(" ACTIONS "),w("div",{class:p([e(l).e("btn"),e(l).e("actions")])},[w("div",{class:p(e(l).e("actions__inner"))},[d(e(N),{onClick:s[1]||(s[1]=i=>a("zoomOut"))},{default:x(()=>[d(e(De))]),_:1}),d(e(N),{onClick:s[2]||(s[2]=i=>a("zoomIn"))},{default:x(()=>[d(e(Be))]),_:1}),w("i",{class:p(e(l).e("actions__divider"))},null,2),d(e(N),{onClick:K},{default:x(()=>[(L(),ie(He(e(M).icon)))]),_:1}),w("i",{class:p(e(l).e("actions__divider"))},null,2),d(e(N),{onClick:s[3]||(s[3]=i=>a("anticlockwise"))},{default:x(()=>[d(e(Ye))]),_:1}),d(e(N),{onClick:s[4]||(s[4]=i=>a("clockwise"))},{default:x(()=>[d(e(Fe))]),_:1})],2)],2),E(" CANVAS "),w("div",{class:p(e(l).e("canvas"))},[(L(!0),O(ce,null,Ze(t.urlList,(i,k)=>je((L(),O("img",{ref_for:!0,ref:S=>z.value[k]=S,key:i,src:i,style:ue(e(ae)),class:p(e(l).e("img")),onLoad:q,onError:W,onMousedown:G},null,46,ot)),[[Se,k===c.value]])),128))],2),ee(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var it=he(rt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const ut=ge(it),ct=pe({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:le([String,Object])},previewSrcList:{type:le(Array),default:()=>we([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),dt={load:o=>o instanceof Event,error:o=>o instanceof Event,switch:o=>f.isNumber(o),close:()=>!0,show:()=>!0},ft=["src","loading"],vt={key:0},mt=te({name:"ElImage",inheritAttrs:!1}),pt=te(Q(X({},mt),{props:ct,emits:dt,setup(o,{emit:r}){const n=o;let v="";const{t:C}=ke(),y=ye("image"),B=We(),l=Je(),g=I(),m=I(!1),z=I(!0),A=I(!1),h=I(),c=I(),M=f.isClient&&"loading"in HTMLImageElement.prototype;let u,Y;const H=_(()=>B.style),Z=_(()=>{const{fit:a}=n;return f.isClient&&a?{objectFit:a}:{}}),F=_(()=>{const{previewSrcList:a}=n;return Array.isArray(a)&&a.length>0}),ae=_(()=>{const{previewSrcList:a,initialIndex:t}=n;let s=t;return t>a.length-1&&(s=0),s}),j=_(()=>n.loading==="eager"?!1:!M&&n.loading==="lazy"||n.lazy),$=()=>{!f.isClient||(z.value=!0,m.value=!1,g.value=n.src)};function se(a){z.value=!1,m.value=!1,r("load",a)}function ne(a){z.value=!1,m.value=!0,r("error",a)}function q(){Qe(h.value,c.value)&&($(),R())}const W=f.useThrottleFn(q,200);function G(){return ve(this,null,function*(){var a;if(!f.isClient)return;yield be();const{scrollContainer:t}=n;et(t)?c.value=t:Ue(t)&&t!==""?c.value=(a=document.querySelector(t))!=null?a:void 0:h.value&&(c.value=tt(h.value)),c.value&&(u=f.useEventListener(c,"scroll",W),setTimeout(()=>q(),100))})}function R(){!f.isClient||!c.value||!W||(u==null||u(),c.value=void 0)}function K(a){if(!!a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function P(){!F.value||(Y=f.useEventListener("wheel",K,{passive:!1}),v=document.body.style.overflow,document.body.style.overflow="hidden",A.value=!0,r("show"))}function U(){Y==null||Y(),document.body.style.overflow=v,A.value=!1,r("close")}function J(a){r("switch",a)}return re(()=>n.src,()=>{j.value?(z.value=!0,m.value=!1,R(),G()):$()}),Ie(()=>{j.value?G():$()}),(a,t)=>(L(),O("div",{ref_key:"container",ref:h,class:p([e(y).b(),a.$attrs.class]),style:ue(e(H))},[g.value!==void 0&&!m.value?(L(),O("img",Ge({key:0},e(l),{src:g.value,loading:a.loading,style:e(Z),class:[e(y).e("inner"),e(F)&&e(y).e("preview"),z.value&&e(y).is("loading")],onClick:P,onLoad:se,onError:ne}),null,16,ft)):E("v-if",!0),z.value||m.value?(L(),O("div",{key:1,class:p(e(y).e("wrapper"))},[z.value?ee(a.$slots,"placeholder",{key:0},()=>[w("div",{class:p(e(y).e("placeholder"))},null,2)]):m.value?ee(a.$slots,"error",{key:1},()=>[w("div",{class:p(e(y).e("error"))},Ke(e(C)("el.image.error")),3)]):E("v-if",!0)],2)):E("v-if",!0),e(F)?(L(),O(ce,{key:2},[A.value?(L(),ie(e(ut),{key:0,"z-index":a.zIndex,"initial-index":e(ae),infinite:a.infinite,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:U,onSwitch:J},{default:x(()=>[a.$slots.viewer?(L(),O("div",vt,[ee(a.$slots,"viewer")])):E("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):E("v-if",!0)],64)):E("v-if",!0)],6))}}));var gt=he(pt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Nt=ge(gt);export{Nt as E};
