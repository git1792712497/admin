var pe=Object.defineProperty,Re=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var te=Math.pow,q=(e,t,n)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))ee.call(t,n)&&q(e,n,t[n]);if(M)for(var n of M(t))ne.call(t,n)&&q(e,n,t[n]);return e},re=(e,t)=>Re(e,Ee(t));var W=(e,t)=>{var n={};for(var r in e)ee.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&M)for(var r of M(e))t.indexOf(r)<0&&ne.call(e,r)&&(n[r]=e[r]);return n};var V=(e,t,n)=>new Promise((r,a)=>{var s=i=>{try{o(n.next(i))}catch(c){a(c)}},u=i=>{try{o(n.throw(i))}catch(c){a(c)}},o=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,u);o((n=n.apply(e,t)).next())});import{i as ie,f as _,r as O,w as J,k as X,l as k,s as U,y as Pe}from"./@vue-f164b9f1.js";const we={},ue=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),se=()=>we,be=Object.prototype.toString,Te=e=>be.call(e),ye=e=>Te(e)==="[object Object]",le=e=>Array.isArray(e),B=e=>e!==null&&typeof e=="object",ce=e=>e instanceof Function,j=e=>e==null,Z=typeof window=="undefined",fe=()=>{var e;return Z||j((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},_e=()=>{var e,t;return(e=!Z&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},z=()=>new Promise(()=>{}),oe=(e,t,n=void 0)=>{const r=t.replace(/\[(\d+)\]/g,".$1").split(".");let a=e;for(const s of r)if(a=Object(a)[s],a===void 0)return n;return a},x=e=>Pe(e)?e.value:e,Oe=e=>B(e)?Object.assign(le(e)?[]:{},e):e,K=new Map,Ce=e=>j(e)?void 0:K.get(e),Le=(e,t,n)=>{const r=K.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const a=setTimeout(()=>K.delete(e),t);K.set(e,re(I({},n),{timer:a}))},A=e=>e;function de(e,t,n){let r,a,s,u,o,i,c=0,g=!1,P=!1,d=!0;const R=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,B(n)&&(g=!!n.leading,P="maxWait"in n,s=P?Math.max(+n.maxWait||0,t):s,d="trailing"in n?!!n.trailing:d);function v(l){const w=r,$=a;return r=a=void 0,c=l,u=e.apply($,w),u}function b(l,w){return R?(window.cancelAnimationFrame(o),window.requestAnimationFrame(l)):setTimeout(l,w)}function f(l){if(R)return window.cancelAnimationFrame(l);clearTimeout(l)}function h(l){return c=l,o=b(E,t),g?v(l):u}function m(l){const w=l-i,$=l-c,F=t-w;return P?Math.min(F,s-$):F}function T(l){const w=l-i,$=l-c;return i===void 0||w>=t||w<0||P&&$>=s}function E(){const l=Date.now();if(T(l))return C(l);o=b(E,m(l))}function C(l){return o=void 0,d&&r?v(l):(r=a=void 0,u)}function L(){o!==void 0&&f(o),c=0,r=i=a=o=void 0}function S(){return o===void 0?u:C(Date.now())}function y(){return o!==void 0}function p(...l){const w=Date.now(),$=T(w);if(r=l,a=this,i=w,$){if(o===void 0)return h(i);if(P)return o=b(E,t),v(i)}return o===void 0&&(o=b(E,t)),u}return p.cancel=L,p.flush=S,p.pending=y,p}function ve(e,t){for(const n in t)if(t[n]!==void 0){if(!B(t[n])||!B(e[n])||!(n in e)){e[n]=t[n];continue}(ye(t[n])||le(t[n]))&&ve(e[n],t[n])}}function ae(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const r of t)ve(n,r);return n}function Se(e,t,n){let r=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return B(n)&&(r="leading"in n?!!n.leading:r,a="trailing"in n?!!n.trailing:a),de(e,t,{leading:r,trailing:a,maxWait:t})}var xe=A((e,{debounceInterval:t,debounceOptions:n,manual:r})=>{const a=O(!1),s=O(),u=_(()=>n),o=_(()=>x(t)),i=O(e.context.runAsync);return r||(a.value=!0),J(c=>{j(o.value)||(s.value=de(g=>g(),o.value,u.value),e.context.runAsync=(...g)=>new Promise((P,d)=>{a.value?(a.value=!1,i.value(...g).then(P).catch(d)):s.value(()=>{i.value(...g).then(P).catch(d)})}),c(()=>{var g;(g=s.value)===null||g===void 0||g.cancel(),e.context.runAsync=i.value}))}),{onCancel(){var c;(c=s.value)===null||c===void 0||c.cancel()}}}),Ae=A((e,{errorRetryCount:t=0,errorRetryInterval:n=0})=>{const r=O(),a=O(0),s=_(()=>x(t)),u=_(()=>x(n));let o=!1;const i=()=>{a.value=0},c=_(()=>{if(u.value)return u.value;const d=1e3,R=1,v=9,b=Math.floor(Math.random()*te(2,Math.min(a.value,v))+R);return d*b}),g=()=>{let d;const R=s.value===-1,v=a.value<s.value;return(R||v)&&(R||(a.value+=1),d=setTimeout(()=>{o=!0,e.context.refresh()},c.value)),()=>d&&clearTimeout(d)},P=()=>{r.value&&r.value()};return{onBefore(){o||i(),o=!1,P()},onSuccess(){i()},onError(){r.value=g()},onCancel(){i(),P()}}}),$e=A((e,{ready:t=O(!0),manual:n,defaultParams:r=[]})=>(X(t,a=>{!n&&a&&e.context.run(...r)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),Ie=A((e,{refreshDeps:t=[],refreshDepsAction:n,manual:r})=>(t!=null&&t.length&&X(t,()=>{n?n():!r&&e.context.refresh()}),{})),Ne=A((e,{throttleInterval:t,throttleOptions:n})=>{const r=O(),a=_(()=>x(t)),s=_(()=>n),u=O(e.context.runAsync);return J(o=>{if(j(t))return{};r.value=Se(i=>i(),a.value,s.value),e.context.runAsync=(...i)=>new Promise((c,g)=>{r.value(()=>{u.value(...i).then(c).catch(g)})}),o(()=>{var i;(i=r.value)===null||i===void 0||i.cancel(),e.context.runAsync=u.value})}),{onCancel(){var o;(o=r.value)===null||o===void 0||o.cancel()}}});const Be=(e,t)=>n=>{Object.keys(n).forEach(r=>{e[r].value=n[r]}),t.forEach(r=>r(e))},je=(e,t)=>()=>{let n=t;for(let r=e.length;r-- >0;)n=e[r](n);return n()},Fe=(e,t,n)=>{var r,a;const{initialData:s,onSuccess:u,onError:o,onBefore:i,onAfter:c}=t,g=O((r=n==null?void 0:n.loading)!==null&&r!==void 0?r:!1),P=U((a=n==null?void 0:n.data)!==null&&a!==void 0?a:s),d=U(n==null?void 0:n.error),R=O(n==null?void 0:n.params),v=O([]),b=U("pending"),f={},h=Be({status:b,loading:g,data:P,error:d,params:R},[]),m=(E,...C)=>{if(E==="onQuery"){const L=v.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:je(L,C[0])()}}else{const L=v.value.map(S=>{var y;return(y=S[E])===null||y===void 0?void 0:y.call(S,...C)});return Object.assign({},...L)}},T=O(0);return f.runAsync=(...E)=>V(void 0,null,function*(){h({loading:!0,params:E,status:"pending"}),T.value+=1;const C=T.value,{isBreak:L,breakResult:S=z()}=m("onBefore",E);if(L)return h({status:"settled"}),S;i==null||i(E);try{const y=()=>new Promise(w=>w(e(...R.value)));let{servicePromise:p}=m("onQuery",y);p||(p=y());const l=yield p;return C!==T.value?z():(h({data:l,loading:!1,error:void 0,status:"settled"}),m("onSuccess",l,E),u==null||u(l,E),m("onAfter",E,l,void 0),c==null||c(E),l)}catch(y){if(C!==T.value)return z();throw h({loading:!1,error:y,status:"settled"}),m("onError",y,E),o==null||o(y,E),m("onAfter",E,void 0,y),c==null||c(E),y}}),f.run=(...E)=>{f.runAsync(...E).catch(C=>{o||console.error(C)})},f.cancel=()=>{T.value+=1,h({loading:!1}),m("onCancel")},f.refresh=()=>{f.run(...R.value||[])},f.refreshAsync=()=>f.runAsync(...R.value||[]),f.mutate=E=>{const C=ce(E)?E(P.value):E,L=Oe(C);h({data:L}),m("onMutate",L)},{status:b,loading:g,data:P,error:d,params:R,plugins:v,context:f}};function Me(e,t={},n){const r=ie(ue,{}),a=I(I(I({},se()),r),t),{manual:s=!1,defaultParams:u=[]}=a,o=Fe(e,a);if(o.plugins.value=n.map(i=>i(o,a)),!s){const i=o.params.value||u;o.context.run(...i)}return k(()=>{o.context.cancel()}),{loading:o.loading,data:o.data,error:o.error,params:o.params,cancel:o.context.cancel,refresh:o.context.refresh,refreshAsync:o.context.refreshAsync,mutate:o.context.mutate,run:o.context.run,runAsync:o.context.runAsync}}const D=new Map,Ke=(e,t)=>{D.set(e,t),t.then(n=>(D.delete(e),n)).catch(()=>{D.delete(e)})},De=e=>D.get(e),N=new Map,Qe=(e,t)=>{N.has(e)&&N.get(e).forEach(n=>n(t))},ke=(e,t)=>(N.has(e)?N.get(e).push(t):N.set(e,[t]),()=>{const n=N.get(e).indexOf(t);N.get(e).splice(n,1)});var We=A((e,{cacheKey:t,cacheTime:n=6e5,staleTime:r=0,getCache:a,setCache:s})=>{if(!t)return{};const u=ce(t)?t:()=>t,o=O(()=>{});let i;const c=f=>a?a(f):Ce(f),g=(f,h,m)=>{s?s(f,m):Le(f,h,m),Qe(f,m.data)},P=f=>r===-1||f+r>new Date().getTime(),d=(f,h)=>Object.prototype.hasOwnProperty.call(f,h),R=f=>{const h=u(f);return ke(h,m=>{e.data.value=m})},v=u(),b=c(v);return b&&d(b,"data")&&(e.data.value=b.data,e.params.value=b.params),v&&(o.value=R()),k(()=>{o.value()}),{onBefore(f){const h=u(f),m=c(h);if(!m||!d(m,"data"))return{};if(P(m.time))return e.data.value=m.data,e.loading.value=!1,{isBreak:!0,breakResult:m.data};e.data.value=m.data},onQuery(f){const h=e.params.value,m=u(h);let T=De(m);return T&&T!==i?()=>T:(T=f(),i=T,Ke(m,T),()=>T)},onSuccess(f,h){const m=u(h);m&&(o.value(),g(m,n,{data:f,params:h,time:new Date().getTime()}),o.value=R(h))},onMutate(f){const h=u(e.params.value);h&&(o.value(),g(h,n,{data:f,params:e.params.value,time:new Date().getTime()}),o.value=R(e.params.value))}}});function Ve(e){let t,n;class r extends Promise{constructor(s){super(s),this.cancel=()=>{n(),clearTimeout(t)}}}return new r(a=>{n=a,t=setTimeout(n,e)})}function G(){return new Date().getTime()}var Ue=A((e,{loadingDelay:t=0,loadingKeep:n=0})=>{const r=O(()=>{}),a=_(()=>x(t)),s=_(()=>x(n));let u=0,o={};const i=()=>{let c;return a.value&&(c=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>c&&clearTimeout(c)};return{onBefore(){e.loading.value=!a.value,r.value(),r.value=i(),u=G()},onQuery(c){if(!s.value)return()=>c();o=Ve(s.value+a.value);const g=()=>V(this,null,function*(){try{const d=yield c();return G()-u<=a.value&&o.cancel(),Promise.resolve(d)}catch(d){return G()-u<=a.value&&o.cancel(),Promise.reject(d)}}),P=Promise.allSettled([g(),o]).then(d=>{const R=d[0];return R.status==="fulfilled"?R.value:Promise.reject(R.reason)});return()=>P},onCancel(){r.value()},onAfter(){r.value()}}}),H;const me=new Set,ge=new Set,he=new Set,Q=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=me;break;case"RECONNECT_LISTENER":n=he;break;case"VISIBLE_LISTENER":n=ge;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},Y=e=>{e.forEach(t=>{t()})};!Z&&(H=window)!==null&&H!==void 0&&H.addEventListener&&(window.addEventListener("visibilitychange",()=>{fe()&&Y(ge)},!1),window.addEventListener("focus",()=>Y(me),!1),window.addEventListener("online",()=>Y(he),!1));var ze=A((e,{pollingInterval:t,pollingWhenHidden:n=!1,pollingWhenOffline:r=!1,errorRetryCount:a=0})=>{const s=O(),u=O(!1),o=_(()=>x(t)),i=_(()=>x(a)),c=[],g=v=>{v&&c.push(v)},P=()=>(n||fe())&&(r||_e()),d=v=>{if(e.error.value&&i.value!==0)return;let b;if(!j(o.value)&&o.value>=0)if(P())b=setTimeout(v,o.value);else{u.value=!0;return}return()=>b&&clearTimeout(b)},R=()=>{u.value&&P()&&(e.context.refresh(),u.value=!1)};return X(o,()=>{s.value&&(s.value(),s.value=d(()=>e.context.refresh()))}),n||g(Q("VISIBLE_LISTENER",R)),r||g(Q("RECONNECT_LISTENER",R)),k(()=>{c.forEach(v=>v())}),{onBefore(){var v;(v=s.value)===null||v===void 0||v.call(s)},onCancel(){var v;(v=s.value)===null||v===void 0||v.call(s)},onAfter(){s.value=d(()=>e.context.refresh())}}});const Ge=(e,t)=>{let n=!1;return(...r)=>{n||(n=!0,e(...r),setTimeout(()=>{n=!1},t))}};var He=A((e,{refreshOnWindowFocus:t=!1,refocusTimespan:n=5e3})=>{const r=_(()=>x(t)),a=_(()=>x(n)),s=[],u=i=>{i&&s.push(i)},o=()=>{s.forEach(i=>i())};return J(()=>{if(o(),r.value){const i=Ge(e.context.refresh,a.value);u(Q("VISIBLE_LISTENER",i)),u(Q("FOCUS_LISTENER",i))}}),k(()=>{o()}),{}});function Ye(e,t){return Me(e,t,[Ue,Ae,xe,ze,Ne,He,Ie,$e,We])}function Ze(e,t={}){const n={currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"},r=ie(ue,{}),S=t,{pagination:a}=S,s=W(S,["pagination"]),{currentKey:u,pageSizeKey:o,totalKey:i,totalPageKey:c}=ae(n,se().pagination||{},r.pagination||{},a||{}),g=ae({defaultParams:[{[u]:1,[o]:10}]},s),y=Ye(e,g),{data:P,params:d,run:R}=y,v=W(y,["data","params","run"]),b=p=>{const[l,...w]=d.value||[],F=[I(I({},l),p),...w];R(...F)},f=p=>{b({[u]:p})},h=p=>{b({[o]:p})},m=(p,l)=>{b({[u]:p,[o]:l})},T=_(()=>oe(P.value,i,0)),E=_({get:()=>{var p,l,w;return(p=(l=d.value)===null||l===void 0||(w=l[0])===null||w===void 0?void 0:w[u])!==null&&p!==void 0?p:g.defaultParams[0][u]},set:p=>{f(p)}}),C=_({get:()=>{var p,l,w;return(p=(l=d.value)===null||l===void 0||(w=l[0])===null||w===void 0?void 0:w[o])!==null&&p!==void 0?p:g.defaultParams[0][o]},set:p=>{h(p)}}),L=_(()=>oe(P.value,c,Math.ceil(T.value/C.value)));return I({data:P,params:d,current:E,pageSize:C,total:T,totalPage:L,run:R,changeCurrent:f,changePageSize:h,changePagination:m},v)}export{Ze as a,Ye as u};
