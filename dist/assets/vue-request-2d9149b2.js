var ae=Object.defineProperty,se=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var q=Math.pow,Z=(e,t,n)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,B=(e,t)=>{for(var n in t||(t={}))ce.call(t,n)&&Z(e,n,t[n]);if(X)for(var n of X(t))fe.call(t,n)&&Z(e,n,t[n]);return e},ee=(e,t)=>se(e,le(t));var j=(e,t,n)=>new Promise((o,i)=>{var a=u=>{try{r(n.next(u))}catch(l){i(l)}},s=u=>{try{r(n.throw(u))}catch(l){i(l)}},r=u=>u.done?o(u.value):Promise.resolve(u.value).then(a,s);r((n=n.apply(e,t)).next())});import{e as b,p as y,w as K,f as H,i as de,z as $,s as W,m as ve}from"./@vue-46cd96cd.js";const me={},ge=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),he=()=>me,Re=e=>Array.isArray(e),Y=e=>e!==null&&typeof e=="object",ne=e=>e instanceof Function,F=e=>e==null,z=typeof window=="undefined",te=()=>{var e;return z||F((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},Ee=()=>{var e,t;return(e=!z&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},k=()=>new Promise(()=>{}),x=e=>ve(e)?e.value:e,we=e=>Y(e)?Object.assign(Re(e)?[]:{},e):e,M=new Map,pe=e=>F(e)?void 0:M.get(e),Te=(e,t,n)=>{const o=M.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const i=setTimeout(()=>M.delete(e),t);M.set(e,ee(B({},n),{timer:i}))},A=e=>e;function re(e,t,n){let o,i,a,s,r,u,l=0,g=!1,w=!1,m=!0;const E=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Y(n)&&(g=!!n.leading,w="maxWait"in n,a=w?Math.max(+n.maxWait||0,t):a,m="trailing"in n?!!n.trailing:m);function d(f){const P=o,I=i;return o=i=void 0,l=f,s=e.apply(I,P),s}function p(f,P){return E?(window.cancelAnimationFrame(r),window.requestAnimationFrame(f)):setTimeout(f,P)}function c(f){if(E)return window.cancelAnimationFrame(f);clearTimeout(f)}function h(f){return l=f,r=p(R,t),g?d(f):s}function v(f){const P=f-u,I=f-l,J=t-P;return w?Math.min(J,a-I):J}function T(f){const P=f-u,I=f-l;return u===void 0||P>=t||P<0||w&&I>=a}function R(){const f=Date.now();if(T(f))return C(f);r=p(R,v(f))}function C(f){return r=void 0,m&&o?d(f):(o=i=void 0,s)}function L(){r!==void 0&&c(r),l=0,o=u=i=r=void 0}function O(){return r===void 0?s:C(Date.now())}function _(){return r!==void 0}function S(...f){const P=Date.now(),I=T(P);if(o=f,i=this,u=P,I){if(r===void 0)return h(u);if(w)return r=p(R,t),d(u)}return r===void 0&&(r=p(R,t)),s}return S.cancel=L,S.flush=O,S.pending=_,S}function be(e,t,n){let o=!0,i=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Y(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),re(e,t,{leading:o,trailing:i,maxWait:t})}var _e=A((e,{debounceInterval:t,debounceOptions:n,manual:o})=>{const i=b(!1),a=b(),s=y(()=>n),r=y(()=>x(t)),u=b(e.context.runAsync);return o||(i.value=!0),K(l=>{F(r.value)||(a.value=re(g=>g(),r.value,s.value),e.context.runAsync=(...g)=>new Promise((w,m)=>{i.value?(i.value=!1,u.value(...g).then(w).catch(m)):a.value(()=>{u.value(...g).then(w).catch(m)})}),l(()=>{var g;(g=a.value)===null||g===void 0||g.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var l;(l=a.value)===null||l===void 0||l.cancel()}}}),Pe=A((e,{errorRetryCount:t=0,errorRetryInterval:n=0})=>{const o=b(),i=b(0),a=y(()=>x(t)),s=y(()=>x(n));let r=!1;const u=()=>{i.value=0},l=y(()=>{if(s.value)return s.value;const m=1e3,E=1,d=9,p=Math.floor(Math.random()*q(2,Math.min(i.value,d))+E);return m*p}),g=()=>{let m;const E=a.value===-1,d=i.value<a.value;return(E||d)&&(E||(i.value+=1),m=setTimeout(()=>{r=!0,e.context.refresh()},l.value)),()=>m&&clearTimeout(m)},w=()=>{o.value&&o.value()};return{onBefore(){r||u(),r=!1,w()},onSuccess(){u()},onError(){o.value=g()},onCancel(){u(),w()}}}),ye=A((e,{ready:t=b(!0),manual:n,defaultParams:o=[]})=>(H(t,i=>{!n&&i&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),Ce=A((e,{refreshDeps:t=[],refreshDepsAction:n,manual:o})=>(t!=null&&t.length&&H(t,()=>{n?n():!o&&e.context.refresh()}),{})),Le=A((e,{throttleInterval:t,throttleOptions:n})=>{const o=b(),i=y(()=>x(t)),a=y(()=>n),s=b(e.context.runAsync);return K(r=>{if(F(t))return{};o.value=be(u=>u(),i.value,a.value),e.context.runAsync=(...u)=>new Promise((l,g)=>{o.value(()=>{s.value(...u).then(l).catch(g)})}),r(()=>{var u;(u=o.value)===null||u===void 0||u.cancel(),e.context.runAsync=s.value})}),{onCancel(){var r;(r=o.value)===null||r===void 0||r.cancel()}}});const xe=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},Ae=(e,t)=>()=>{let n=t;for(let o=e.length;o-- >0;)n=e[o](n);return n()},Oe=(e,t,n)=>{var o,i;const{initialData:a,onSuccess:s,onError:r,onBefore:u,onAfter:l}=t,g=b((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),w=W((i=n==null?void 0:n.data)!==null&&i!==void 0?i:a),m=W(n==null?void 0:n.error),E=b(n==null?void 0:n.params),d=b([]),p=W("pending"),c={},h=xe({status:p,loading:g,data:w,error:m,params:E},[]),v=(R,...C)=>{if(R==="onQuery"){const L=d.value.map(O=>O.onQuery).filter(Boolean);return{servicePromise:Ae(L,C[0])()}}else{const L=d.value.map(O=>{var _;return(_=O[R])===null||_===void 0?void 0:_.call(O,...C)});return Object.assign({},...L)}},T=b(0);return c.runAsync=(...R)=>j(void 0,null,function*(){h({loading:!0,params:R,status:"pending"}),T.value+=1;const C=T.value,{isBreak:L,breakResult:O=k()}=v("onBefore",R);if(L)return h({status:"settled"}),O;u==null||u(R);try{const _=()=>new Promise(P=>P(e(...E.value)));let{servicePromise:S}=v("onQuery",_);S||(S=_());const f=yield S;return C!==T.value?k():(h({data:f,loading:!1,error:void 0,status:"settled"}),v("onSuccess",f,R),s==null||s(f,R),v("onAfter",R,f,void 0),l==null||l(R),f)}catch(_){if(C!==T.value)return k();throw h({loading:!1,error:_,status:"settled"}),v("onError",_,R),r==null||r(_,R),v("onAfter",R,void 0,_),l==null||l(R),_}}),c.run=(...R)=>{c.runAsync(...R).catch(C=>{r||console.error(C)})},c.cancel=()=>{T.value+=1,h({loading:!1}),v("onCancel")},c.refresh=()=>{c.run(...E.value||[])},c.refreshAsync=()=>c.runAsync(...E.value||[]),c.mutate=R=>{const C=ne(R)?R(w.value):R,L=we(C);h({data:L}),v("onMutate",L)},{status:p,loading:g,data:w,error:m,params:E,plugins:d,context:c}};function Se(e,t={},n){const o=de(ge,{}),i=B(B(B({},he()),o),t),{manual:a=!1,defaultParams:s=[]}=i,r=Oe(e,i);if(r.plugins.value=n.map(u=>u(r,i)),!a){const u=r.params.value||s;r.context.run(...u)}return $(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const D=new Map,Ie=(e,t)=>{D.set(e,t),t.then(n=>(D.delete(e),n)).catch(()=>{D.delete(e)})},Ne=e=>D.get(e),N=new Map,Be=(e,t)=>{N.has(e)&&N.get(e).forEach(n=>n(t))},Fe=(e,t)=>(N.has(e)?N.get(e).push(t):N.set(e,[t]),()=>{const n=N.get(e).indexOf(t);N.get(e).splice(n,1)});var Me=A((e,{cacheKey:t,cacheTime:n=6e5,staleTime:o=0,getCache:i,setCache:a})=>{if(!t)return{};const s=ne(t)?t:()=>t,r=b(()=>{});let u;const l=c=>i?i(c):pe(c),g=(c,h,v)=>{a?a(c,v):Te(c,h,v),Be(c,v.data)},w=c=>o===-1||c+o>new Date().getTime(),m=(c,h)=>Object.prototype.hasOwnProperty.call(c,h),E=c=>{const h=s(c);return Fe(h,v=>{e.data.value=v})},d=s(),p=l(d);return p&&m(p,"data")&&(e.data.value=p.data,e.params.value=p.params),d&&(r.value=E()),$(()=>{r.value()}),{onBefore(c){const h=s(c),v=l(h);if(!v||!m(v,"data"))return{};if(w(v.time))return e.data.value=v.data,e.loading.value=!1,{isBreak:!0,breakResult:v.data};e.data.value=v.data},onQuery(c){const h=e.params.value,v=s(h);let T=Ne(v);return T&&T!==u?()=>T:(T=c(),u=T,Ie(v,T),()=>T)},onSuccess(c,h){const v=s(h);v&&(r.value(),g(v,n,{data:c,params:h,time:new Date().getTime()}),r.value=E(h))},onMutate(c){const h=s(e.params.value);h&&(r.value(),g(h,n,{data:c,params:e.params.value,time:new Date().getTime()}),r.value=E(e.params.value))}}});function De(e){let t,n;class o extends Promise{constructor(a){super(a),this.cancel=()=>{n(),clearTimeout(t)}}}return new o(i=>{n=i,t=setTimeout(n,e)})}function V(){return new Date().getTime()}var Qe=A((e,{loadingDelay:t=0,loadingKeep:n=0})=>{const o=b(()=>{}),i=y(()=>x(t)),a=y(()=>x(n));let s=0,r={};const u=()=>{let l;return i.value&&(l=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},i.value)),()=>l&&clearTimeout(l)};return{onBefore(){e.loading.value=!i.value,o.value(),o.value=u(),s=V()},onQuery(l){if(!a.value)return()=>l();r=De(a.value+i.value);const g=()=>j(this,null,function*(){try{const m=yield l();return V()-s<=i.value&&r.cancel(),Promise.resolve(m)}catch(m){return V()-s<=i.value&&r.cancel(),Promise.reject(m)}}),w=Promise.allSettled([g(),r]).then(m=>{const E=m[0];return E.status==="fulfilled"?E.value:Promise.reject(E.reason)});return()=>w},onCancel(){o.value()},onAfter(){o.value()}}}),U;const oe=new Set,ue=new Set,ie=new Set,Q=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=oe;break;case"RECONNECT_LISTENER":n=ie;break;case"VISIBLE_LISTENER":n=ue;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},G=e=>{e.forEach(t=>{t()})};!z&&(U=window)!==null&&U!==void 0&&U.addEventListener&&(window.addEventListener("visibilitychange",()=>{te()&&G(ue)},!1),window.addEventListener("focus",()=>G(oe),!1),window.addEventListener("online",()=>G(ie),!1));var $e=A((e,{pollingInterval:t,pollingWhenHidden:n=!1,pollingWhenOffline:o=!1,errorRetryCount:i=0})=>{const a=b(),s=b(!1),r=y(()=>x(t)),u=y(()=>x(i)),l=[],g=d=>{d&&l.push(d)},w=()=>(n||te())&&(o||Ee()),m=d=>{if(e.error.value&&u.value!==0)return;let p;if(!F(r.value)&&r.value>=0)if(w())p=setTimeout(d,r.value);else{s.value=!0;return}return()=>p&&clearTimeout(p)},E=()=>{s.value&&w()&&(e.context.refresh(),s.value=!1)};return H(r,()=>{a.value&&(a.value(),a.value=m(()=>e.context.refresh()))}),n||g(Q("VISIBLE_LISTENER",E)),o||g(Q("RECONNECT_LISTENER",E)),$(()=>{l.forEach(d=>d())}),{onBefore(){var d;(d=a.value)===null||d===void 0||d.call(a)},onCancel(){var d;(d=a.value)===null||d===void 0||d.call(a)},onAfter(){a.value=m(()=>e.context.refresh())}}});const je=(e,t)=>{let n=!1;return(...o)=>{n||(n=!0,e(...o),setTimeout(()=>{n=!1},t))}};var We=A((e,{refreshOnWindowFocus:t=!1,refocusTimespan:n=5e3})=>{const o=y(()=>x(t)),i=y(()=>x(n)),a=[],s=u=>{u&&a.push(u)},r=()=>{a.forEach(u=>u())};return K(()=>{if(r(),o.value){const u=je(e.context.refresh,i.value);s(Q("VISIBLE_LISTENER",u)),s(Q("FOCUS_LISTENER",u))}}),$(()=>{r()}),{}});function Ue(e,t){return Se(e,t,[Qe,Pe,_e,$e,Le,We,Ce,ye,Me])}export{Ue as u};
